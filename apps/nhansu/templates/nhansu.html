<title id="title">Nhân sự | TCCB - USSH</title>

<div id="boder" class="basis-full shrink overflow-y-hidden overflow-x-hidden flex flex-col justify-start items-center">
    <div id="container" 
    x-ref="container"
    x-data="{
        search: '',
        dataframe: {},
        output: [],
        isLoading: false,
        miniSearch: '',
        getSearchResults() {
            if (this.search === '') {
                this.output = Object.values(this.dataframe);
            } else {
                this.output = this.miniSearch.search(this.search).map(({ id }) => this.dataframe[id])
            }
        },
        async getData() {
            this.miniSearch = new MiniSearch({
                fields: ['maso','hovaten','ngaysinh'],
                searchOptions: {
                    prefix: true,
                    combineWith: 'AND',
                },
                extractField: (document, fieldName) => {
                    if (fieldName === 'maso') {
                        const nguyen = document['maso']
                        if (nguyen) {
                            return nguyen && nguyen + ' ' + nguyen.slice(6) + ' ' + nguyen.slice(3)
                        }
                    }
                    return fieldName.split('.').reduce((doc, key) => doc && doc[key], document)
                },
            })
            this.isLoading = true;
            fetch('/api/nhansu/search')            
                .then((response) => response.json())
                .then((result) => { 
                    this.dataframe = result.reduce((byId, song) => {
                        byId[song.id] = song;
                        return byId;
                    }, {});
                    this.output = Object.values(this.dataframe);
                    this.miniSearch.addAll(result);
                    this.isLoading = false;
                });
        }
    }"
    x-init="getData()"
    class="overflow-auto w-full h-full flex flex-col justify-start items-center px-[30px] py-[15px] gap-2">
        <div class="w-full flex flex-row justify-center items-center shrink-0">

            <!-- {# Trang chủ/nhân sự #}
            <div class="w-[150px] flex flex-col justify-start items-start">
            </div>
            {# End Trang chủ/nhân sự #} -->


            <!-- {# Search #} -->
            <div class="w-[500px] h-[50px] rounded-3xl bg-gray-100 flex flex-row justify-start items-center mb-[20px]">
                <div class="basis-[50px] shrink-0 rounded-full">
                    <i class="fa-solid fa-magnifying-glass text-[14px] text-gray-400"></i>
                </div>
                <input x-model="search"
                @input="getSearchResults()"
                class="transition-none bg-gray-100 p-0 rounded-r-3xl basis-[87%] shrink text-[16px] border-transparent focus:border-transparent focus:ring-0" 
                type="search">
            </div>
            <!-- {# End search #} -->

        </div>


        <!-- {# Hashtags #}
        <div id="hashtags" class="z-[2] w-full h-auto mb-[15px] flex flex-row justify-center items-start">
            <div x-data="{
                focusinput: false,
                showoptions: false,
                items: ['banana','bababa','bahaha','mango','apple','orange','chili','lemon','sdfsfssfdsfs','wetrtwrfggsferwete','ghtyutyutyesrtedfsrw'],
                results: [],
                search: '',
                research: '',
                backspace: true,
                choose: 0,
                get filteredItems() {
                    if (this.search !== '') {
                        return this.items.filter(
                            i => i.startsWith(this.search)
                        )
                    } else {
                        return []
                    }
  
                },
                get checkresults() {
                    return this.results.length === 0
                },
                addItem(value) {
                    console.log(value);
                    this.items = this.items.filter(i => i !== value);
                    this.results.push(value); 
                    this.search = '';
                    this.showoptions = false;
                },
                removeItem(value) {
                    console.log(value);
                    this.results = this.results.filter(i => i !== value);
                    this.items.push(value);
                },
                checkItem() {
                    if (this.filteredItems.length == 0) {
                        this.search = ''
                    }     
                },
                enterEvent() {
                    if (typeof this.filteredItems[this.choose] !== 'undefined') {
                        this.addItem(this.filteredItems[this.choose])
                    } else {
                        this.search = ''
                    }
                },
                eventBackspace() {
                    this.backspace = true;
                },
                checkdown() {
                    if (this.backspace === true) {
                        this.research = this.search;
                        this.backspace = false;
                        if (this.research === '' && this.results.length > 0) {
                            value = this.results.at(-1);
                            this.results = this.results.filter(i => i !== value);
                            this.items.push(value);
                     
                        }
                    }
                },
                showoptionscheck(e) {
                    if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                        this.choose = 0;
                    }
                    if (this.search !== '' && this.focusinput == true) {
                        this.showoptions = true;
                    } else {
                        this.showoptions = false;
                    }
                },
                focusinputcheck() {
                    this.focusinput = true;
                    if (this.search !== '') {
                        this.showoptions = true;
                    }
                },
                checkchoose(index) {
                    return index === this.choose
                },
                selectoption(type) {
                    if (type === 'up' && this.choose > 0) {
                        this.choose = this.choose - 1
                    } else if (type === 'down' && this.choose < (this.filteredItems.length - 1)) {
                        this.choose = this.choose + 1
                    }
                }
            }"
            class="w-[600px]"
            @click.outside="focusinput = false; showoptions = false;">

                <div x-ref="divinput"
                class="relative rounded-lg w-full flex flex-row justify-center items-start flex-wrap py-[8px] px-[15px] gap-2">
                        {# <i class="absolute top-[10px] left-[5px] text-gray-300 text-[20px] fa-solid fa-hashtag"></i> #}
                        <div :class="checkresults ? 'bg-[#ff4b4b]' : 'bg-gray-400'"
                        class="text-[13px]  rounded-md text-white px-[10px] py-[2px] cursor-default flex flex-row items-center relative">
                            <div># Tất cả</div>
                        </div>
                    <template x-for="result in results" :key="result">
                        <div class="text-[13px] bg-[#ff4b4b] rounded-md text-white px-[10px] py-[2px] cursor-default flex flex-row items-center relative">
                            <div x-text="'# ' + result"></div>
                            <i @click="removeItem(result)"
                            class="fa-solid fa-xmark cursor-pointer pl-[10px]"></i>
                        </div>
                    </template>
                    <div class="rounded-lg border border-orange overflow-hidden relative px-[10px] min-w-[100px] w-auto max-w-[100%] h-[25px] flex flex-row justify-start">
                        <span x-text="search + 'a'" 
                        x-ref="span" 
                        class="invisible text-[14px] p-0"></span>
                        <input type="text" 
                        placeholder="Nhập tag..."
                        @click.outside="checkItem()"
                        @keyup.enter="enterEvent()"
                        @keydown.up.prevent.throttle.100ms="selectoption('up')"
                        @keydown.down.prevent.throttle.100ms="selectoption('down')"
                        @keyup.up.prevent
                        @keyup.down.prevent
                        class="w-[100%] absolute px-[10px] left-0 text-[14px] py-[5px] border-transparent focus:border-transparent focus:ring-0 top-[50%] translate-y-[-50%]"
                        x-ref="input"
                        x-model="search"
                        @focus="focusinputcheck()"
                        @keydown.backspace="checkdown()"
                        @keyup = 'showoptionscheck'
                        @keyup.backspace="eventBackspace"/>
                    </div>
                </div>

                <div x-show="showoptions" x-anchor.bottom="$refs.input">
                    <ul class="shadow-xl bg-white rounded-lg w-[300px] h-auto flex flex-col overflow-hidden">
                        <template x-if="filteredItems.length === 0">
                            <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                        </template>
                        <template x-for="(item, index) in filteredItems" :key="item">
                            <li x-text="item"
                            @click="addItem(item)"
                            @mouseover="choose = index"
                            :class="checkchoose(index) ? 'bg-gray-100' : ''"
                            class="text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                        </template>
                    </ul>
                </div>
            </div>
        </div>
        {# End Hashtags #} -->

        <!-- tabs row-->
        <div id="tabs" 
        x-data="{tab1Active: false, tab2Active: true}"
        class="z-[1] relative rounded-md w-full max-w-[1000px] flex flex-row justify-start items-start border">
            <div id="tab" 
            :class="tab1Active ? 'border-b-2 border-b-orange font-[500] shadow-md' : 'hover:bg-gray-100'"
            @click="$dispatch('tab1'); tab1Active = true; tab2Active = false"
            class="p-[10px] cursor-pointer">Nhân sự trong Trường</div>
            <div id="tab2"
            :class="tab2Active ? 'border-b-2 border-b-orange font-[500] shadow-md' : 'hover:bg-gray-100'"
            @click="$dispatch('tab2'); tab1Active = false; tab2Active = true"
            class="p-[10px] cursor-pointer">Nhân sự ngoài Trường</div>
        </div>
        <!-- end tabs row -->

        <!-- tab 1 -->
        <div x-data="{show:false}"
        @tab2.window="show = false"
        @tab1.window="show = true"
        x-show="show"
        class="w-full max-w-[1000px]">
        TAB NHANSU IN TRUONG - COMMING SOON...
        </div>

        <!-- tab 2 -->
        <div x-data="{show:true}"
        @tab2.window="show = true"
        @tab1.window="show = false"
        x-show="show"
        class="w-full max-w-[1000px]">
            {# Table #}
            <div id="table" class="z-[1] shadow-lg relative rounded-lg w-full max-w-[1000px] flex flex-col justify-start text-left">
                <!-- head of table -->
                <div id="thead" 
                class="sticky top-[-15px] w-full min-w-[750px] flex flex-row bg-gray-200 text-black font-[700] rounded-t-lg z-[1]">
                    <div class="w-[5%] min-w-[50px] flex flex-row justify-start items-center">
                        <div class="p-[15px]">#</div>
                    </div>
                    <div class="w-[15%] min-w-[100px] flex flex-row justify-start items-center">
                        <div class="py-[15px]">MSCB</div>
                    </div>
                    <div class="w-[25%] min-w-[200px] flex flex-row justify-start items-center">
                        <div class="py-[15px]">Họ và tên</div>
                    </div>
                    <div class="w-[20%] min-w-[100px] flex flex-row justify-start items-center">
                        <div class="py-[15px]">Ngày sinh</div>
                    </div>
                    <div class="w-[25%] min-w-[220px] flex flex-row justify-start items-center">
                        <div class="py-[15px]">Đơn vị</div>
                    </div>
                    <div class="w-[10%] min-w-[80px] flex flex-row justify-center items-center">
                        <div class="py-[15px]">@</div>
                    </div>
                </div>
                <!-- end head of table -->            
            
                <!-- body of table -->
                <div id="tbody" 
                x-show="! isLoading"
                class="bg-white max-w-[1000px] rounded-b-lg flex flex-col w-auto justify-start items-start overflow-y-hidden">
                    <template x-for="(item, index) in output" :key="index">
                        <div id="trow" class="hover:bg-gray-100 cursor-default w-full min-w-[750px] flex flex-row bg-white font-[500]">
                            {# index #}
                            <div class="w-[5%] min-w-[50px] flex flex-row justify-start items-center font-[400]">
                                <div x-text="index + 1" class="py-[10px] px-[15px]"></div>
                            </div>
                            {# end index #}

                            {# maso #}
                            <div class="w-[15%] min-w-[100px] flex flex-row justify-start items-center">
                                <div x-text="item.maso" class="py-[10px]"></div>
                            </div>
                            {# end maso #}

                            {# hovaten #}
                            <div class="w-[25%] min-w-[200px] flex flex-row justify-start items-center text-blue">
                                <div @click="$dispatch('portfolio', {target: item.maso})"
                                x-text="item.hovaten" class="py-[10px] hover:underline cursor-pointer"></div>
                            </div>
                            {# end hovaten #}

                            {# ngaysinh #}
                            <div class="w-[20%] min-w-[100px] flex flex-row justify-start items-center font-[400]">
                                <div x-text="item.ngaysinh" class="py-[10px]"></div>
                            </div>
                            {# end ngaysinh #}

                            {# donvi #}
                            <div class="w-[25%] min-w-[220px] flex flex-row justify-start items-center font-[400]">
                                <div class="py-[10px]">Khoa Ngữ văn Tây Ban Nha - Italia</div>
                            </div>
                            {# end donvi #}

                            {# button hoso #}
                            <div class="w-[10%] min-w-[80px] flex flex-row justify-center items-center font-[400]">
                                <div class="hover:bg-green hover:border-transparent rounded-2xl border-2 border-green px-[10px] py-[0px] font-[500] cursor-pointer text-[12px]"
                                >Chọn</div>
                            </div>
                            {# end button hoso #}
                        </div>
                    </template>
                </div>
                <!-- end body of table -->

                {# skeleton #}
                <div x-show="isLoading"
                class="mt-[20px] relative w-full flex flex-col gap-8">
                    <div class="skeleton h-32 w-full"></div>
                    <div class="skeleton h-4 w-28"></div>
                    <div class="skeleton h-4 w-full"></div>
                    <div class="skeleton h-4 w-full"></div>
                </div>
                {# end skeleton #}

            </div>
            {# End Table #}
        </div>
        <!-- end tab 2 -->
        
        <!-- hoso -->
        <div x-data="{open: false, target: '', thinhgiang: {}}" x-show="open" 
        @portfolio.window="target = $event.detail.target; 
        open = true
        fetch(`/api/nhansu/thinhgiang/read/${target}`)
        .then((response) => response.json())
        .then((result) => {
            thinhgiang = result;
        });"
        @newportfolio.window="open = true;
        thinhgiang = {}"
        class="flex justify-center items-start fixed left-0 top-0 h-screen w-screen z-[3001] py-[20px] overflow-auto">
            <div x-show="open" 
            @click="open = false; $dispatch('closepopup');" 
            @keyup.escape.window="open = false; $dispatch('closepopup');" 
            class="fixed left-0 top-0 w-screen h-screen bg-black opacity-70">
            </div>
            <div class="z-[1] gap-4 px-[16px] py-[32px] rounded-xl overflow-hidden w-[800px] h-auto bg-white opacity-100">
                <!-- tieu de -->
                <div class="w-full flex flex-col justify-center items-start">
                    <div class="w-full text-[27px] font-[600] leading-tight mb-[20px]">
                        Hồ sơ [<span x-text="target"></span>]
                    </div>
                    <div class="w-full border my-[15px]"></div>
                </div>
                <!-- end tieu de -->

                <!-- noi dung -->
                <div class="w-full flex flex-col justify-start items-start gap-6">
                    <div class="text-[16px] text-black font-[500] mt-[10px]">
                        Thông tin cá nhân
                    </div>
                    <div class="w-full flex flex-row justify-start items-start gap-6">
                        <!-- start họ và tên -->
                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Họ và tên <span class="text-red-600"> *</span>
                            </div>
                            <input type="search" 
                            x-model="thinhgiang.hovaten"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>
                        <!-- end họ và tên -->

                        <!-- start ngày sinh -->
                        <div class="basis-[24%] shrink flex flex-col justify-start items-start gap-2">
                            
                            <div>
                                Ngày sinh <span class="text-red-600"> *</span>
                            </div>
                            <input x-data="{
                                checkStrDate(str) {
                                    if (str) {
                                        const result = [...str].every(
                                            char => (char >= '0' && char <= '9') || (char == '/')
                                        );
                                        return result;
                                    } else {
                                        return false
                                    }
                                },
                                converDay() {
                                    if (this.checkStrDate(thinhgiang.ngaysinh)) {
                                        list = thinhgiang.ngaysinh.split('/');
                                        d = Number(list[0])
                                        m = Number(list[1])
                                        y = Number(list[2])
                                        if (list.length !== 3 || 
                                            list[0].length > 2 || 
                                            list[1].length > 2 || 
                                            list[2].length > 4 || 
                                            list[2].length == 3 ||
                                            d > 31 ||
                                            m > 12 ||
                                            y > 2099) {
                                            thinhgiang.ngaysinh = ''
                                        } else {
                                            today = new Date();
                                            currentYear = today.getFullYear();

                                            if (list[2].length == 2) {
                                                if (y > (currentYear - 2000)) {
                                                    year_num = y + 1900
                                                } else {
                                                    year_num = y + 2000
                                                }
                                            } else {
                                                year_num = y
                                            }
                                            if ((m == 2 && d > 29) || ([1,3,5,7,8,10,12].includes(m) && d > 31) || ([2,4,6,9,11].includes(m) && d > 30)) {
                                                thinhgiang.ngaysinh = ''
                                            } else {
                                                day = d.toString().padStart(2,'0')
                                                if ([1,2].includes(m)) {
                                                    month = m.toString().padStart(2,'0')
                                                } else {
                                                    month = m.toString()
                                                }
                                                year = year_num.toString()
                                                thinhgiang.ngaysinh = `${day}/${month}/${year}`
                                            }
                                        }
                                    } else {
                                        thinhgiang.ngaysinh = ''
                                    }
 
                                }
                            }"
                            type="search"
                            @focusout="converDay()"
                            @keyup.enter="converDay()"
                            placeholder="dd/mm/yyyy"
                            x-model="thinhgiang.ngaysinh"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>
                        <!-- end ngày sinh -->

                        <!-- start giới tính -->
                        <div x-data="{
                            showoptions: false,
                            output: [],
                            dataframe: [],
                            research: '',
                            backspace: true,
                            choose: 0,
                            miniSearch,
                            async getData() {
                                this.miniSearch = new MiniSearch({
                                    fields: ['value'],
                                    searchOptions: {
                                        prefix: true,
                                        combineWith: 'AND',
                                    }
                                })
                                fetch('/api/danhmuc/gioitinh')            
                                .then((response) => response.json())
                                .then((result) => {
                                    this.dataframe = result.reduce((byId, song) => {
                                        byId[song.id] = song;
                                        return byId;
                                    }, {});
                                    this.output = Object.values(this.dataframe);
                                    this.miniSearch.addAll(result);
                                });
                            },
                            filteredItems() {
                                this.showoptions = true;
                                if (thinhgiang.gioitinh) {
                                    this.output = this.miniSearch.search(thinhgiang.gioitinh).map(({ id }) => this.dataframe[id])
                                } else {
                                    this.output = Object.values(this.dataframe);
                                }
                            },
                            addItem(item) {
                                thinhgiang.gioitinh = item.value;
                                this.showoptions = false;
                            },
                            checkItem() {
                                this.filteredItems()
                                if (this.output.length >= 1) {
                                    if (thinhgiang.gioitinh != this.output[0].value) {
                                        thinhgiang.gioitinh = ''
                                    }
                                } else {
                                    thinhgiang.gioitinh = ''
                                }
                            },
                            enterEvent() {
                                if (this.output) {
                                    this.addItem(this.output[this.choose])
                                } else {
                                    thinhgiang.gioitinh = ''
                                }
                            },
                            eventBackspace() {
                                this.backspace = true;
                            },
                            showoptionscheck(e) {
                                if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                    this.choose = 0;
                                }
                            },
                            focusinputcheck() {
                                this.filteredItems();
                                this.showoptions = true;
                            },
                            checkchoose(index) {
                                return index === this.choose
                            },
                            selectoption(type) {
                                if (type === 'up' && this.choose > 0) {
                                    this.choose = this.choose - 1
                                    item = document.getElementById('gioitinh'+this.choose).getBoundingClientRect()
                                    frame = $refs.gioitinh.getBoundingClientRect()
                                    if ((item.bottom - frame.top) < item.height) {
                                        $refs.gioitinh.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                    }
                                } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                    this.choose = this.choose + 1
                                    item = document.getElementById('gioitinh'+this.choose).getBoundingClientRect()
                                    frame = $refs.gioitinh.getBoundingClientRect()
                                    if ((frame.bottom - item.top) < item.height) {
                                        $refs.gioitinh.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                    }
                                }
                            }
                        }" x-init="getData()"
                        class="basis-[23%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Giới tính <span class="text-red-600"> *</span>
                            </div>
                            <input type="search"
                            @focusout.debounce.100ms="checkItem();showoptions = false;"
                            @keyup.enter="enterEvent()"
                            @keydown.up.prevent.throttle.100ms="selectoption('up')"
                            @keydown.down.prevent.throttle.100ms="selectoption('down')"
                            @keyup.up.prevent
                            @keyup.down.prevent
                            x-ref="input"
                            @focus="focusinputcheck()"
                            @keyup = 'showoptionscheck'
                            @keyup.backspace="eventBackspace"
                            x-model="thinhgiang.gioitinh"
                            @input="filteredItems()"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">

                            <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                <ul x-ref="gioitinh" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[175px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                    <template x-if="output.length === 0">
                                        <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                    </template>
                                    <template x-for="(item, index) in output" :key="item.id">
                                        <li x-text="item.value"
                                        :id="'gioitinh'+index"
                                        @click="addItem(item)"
                                        @mouseover="choose = index"
                                        :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                        class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                    </template>
                                </ul>
                            </div>
                        
                        </div>
                        <!-- end giới tính -->
                    </div>
                    <div class="w-full flex flex-row justify-start items-start gap-6">
                        <!-- start quốc tịch -->
                        <div x-data="{
                            showoptions: false,
                            output: [],
                            dataframe: [],
                            research: '',
                            backspace: true,
                            choose: 0,
                            miniSearch,
                            async getData() {
                                this.miniSearch = new MiniSearch({
                                    fields: ['value'],
                                    searchOptions: {
                                        prefix: true,
                                        combineWith: 'AND',
                                    }
                                })
                                fetch('/api/danhmuc/quocgia')            
                                .then((response) => response.json())
                                .then((result) => {
                                    this.dataframe = result.reduce((byId, song) => {
                                        byId[song.id] = song;
                                        return byId;
                                    }, {});
                                    this.output = Object.values(this.dataframe);
                                    this.miniSearch.addAll(result);
                                });
                            },
                            filteredItems() {
                                this.showoptions = true;
                                if (thinhgiang.quoctich) {
                                    this.output = this.miniSearch.search(thinhgiang.quoctich).map(({ id }) => this.dataframe[id])
                                } else {
                                    this.output = Object.values(this.dataframe);
                                }
                            },
                            addItem(item) {
                                thinhgiang.quoctich = item.value;
                                this.showoptions = false;
                            },
                            checkItem() {
                                this.filteredItems()
                                if (this.output.length >= 1) {
                                    if (thinhgiang.quoctich != this.output[0].value) {
                                        thinhgiang.quoctich = ''
                                    }
                                } else {
                                    thinhgiang.quoctich = ''
                                }
                            },
                            enterEvent() {
                                if (this.output) {
                                    this.addItem(this.output[this.choose])
                                } else {
                                    thinhgiang.quoctich = ''
                                }
                            },
                            eventBackspace() {
                                this.backspace = true;
                            },
                            showoptionscheck(e) {
                                if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                    this.choose = 0;
                                }
                            },
                            focusinputcheck() {
                                this.filteredItems();
                                this.showoptions = true;
                            },
                            checkchoose(index) {
                                return index === this.choose
                            },
                            selectoption(type) {
                                if (type === 'up' && this.choose > 0) {
                                    this.choose = this.choose - 1
                                    item = document.getElementById('quoctich'+this.choose).getBoundingClientRect()
                                    frame = $refs.quoctich.getBoundingClientRect()
                                    if ((item.bottom - frame.top) < item.height) {
                                        $refs.quoctich.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                    }
                                } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                    this.choose = this.choose + 1
                                    item = document.getElementById('quoctich'+this.choose).getBoundingClientRect()
                                    frame = $refs.quoctich.getBoundingClientRect()
                                    if ((frame.bottom - item.top) < item.height) {
                                        $refs.quoctich.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                    }
                                }
                            }
                        }" x-init="getData()"
                        class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Quốc tịch
                            </div>
                            <input type="search"
                            @focusout.debounce.100ms="checkItem();showoptions = false;"
                            @keyup.enter="enterEvent()"
                            @keydown.up.prevent.throttle.100ms="selectoption('up')"
                            @keydown.down.prevent.throttle.100ms="selectoption('down')"
                            @keyup.up.prevent
                            @keyup.down.prevent
                            x-ref="input"
                            @focus="focusinputcheck()"
                            @keyup = 'showoptionscheck'
                            @keyup.backspace="eventBackspace"
                            x-model="thinhgiang.quoctich"
                            @input="filteredItems()"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">

                            <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                <ul x-ref="quoctich" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[375px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                    <template x-if="output.length === 0">
                                        <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                    </template>
                                    <template x-for="(item, index) in output" :key="item.id">
                                        <li x-text="item.value"
                                        :id="'quoctich'+index"
                                        @click="addItem(item)"
                                        @mouseover="choose = index"
                                        :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                        class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                    </template>
                                </ul>
                            </div>
                        
                        </div>
                        <!-- end quốc tịch -->

                        <!-- start mã số cán bộ -->
                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                MSCB <span class="text-red-600"> *</span>
                            </div>
                            <input type="search" 
                            x-model="thinhgiang.maso"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>
                        <!-- end mã số cán bộ -->
                    </div>


                    <div class="w-full flex flex-row justify-start items-start gap-6">
                        <div class="basis-[24%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Số CCCD/Hộ chiếu
                            </div>
                            <input type="search" 
                            x-model="thinhgiang.CCCD_so"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>

                        <div class="basis-[23%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Ngày cấp
                            </div>
                            <input x-data="{
                                checkStrDate(str) {
                                    if (str) {
                                        const result = [...str].every(
                                            char => (char >= '0' && char <= '9') || (char == '/')
                                        );
                                        return result;
                                    } else {
                                        return false
                                    }
                                },
                                converDay() {
                                    if (this.checkStrDate(thinhgiang.CCCD_ngay)) {
                                        list = thinhgiang.CCCD_ngay.split('/');
                                        d = Number(list[0])
                                        m = Number(list[1])
                                        y = Number(list[2])
                                        if (list.length !== 3 || 
                                            list[0].length > 2 || 
                                            list[1].length > 2 || 
                                            list[2].length > 4 || 
                                            list[2].length == 3 ||
                                            d > 31 ||
                                            m > 12 ||
                                            y > 2999) {
                                            thinhgiang.CCCD_ngay = ''
                                        } else {
                                            today = new Date();
                                            currentYear = today.getFullYear();

                                            if (list[2].length == 2) {
                                                if (y > (currentYear - 2000)) {
                                                    year_num = y + 1900
                                                } else {
                                                    year_num = y + 2000
                                                }
                                            } else {
                                                year_num = y
                                            }
                                            if ((m == 2 && d > 29) || ([1,3,5,7,8,10,12].includes(m) && d > 31) || ([2,4,6,9,11].includes(m) && d > 30)) {
                                                thinhgiang.CCCD_ngay = ''
                                            } else {
                                                day = d.toString().padStart(2,'0')
                                                if ([1,2].includes(m)) {
                                                    month = m.toString().padStart(2,'0')
                                                } else {
                                                    month = m.toString()
                                                }
                                                year = year_num.toString()
                                                thinhgiang.CCCD_ngay = `${day}/${month}/${year}`
                                            }
                                        }
                                    } else {
                                        thinhgiang.CCCD_ngay = ''
                                    }
 
                                }
                            }"
                            type="search"
                            @focusout="converDay()"
                            @keyup.enter="converDay()"
                            x-model="thinhgiang.CCCD_ngay"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>

                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Nơi cấp
                            </div>
                            <input type="search" 
                            value="Cục Cảnh sát Quản lý Hành chính về Trật tự Xã hội"
                            class="w-full h-[45px] text-[15px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>
                    </div>
                    <div class="w-full flex flex-row justify-start items-start gap-6">
                        <div x-data="{
                            checkemail () {
                                if (thinhgiang.email.includes('@hcmussh.edu.vn')) {
                                    return true
                                } else {
                                    thinhgiang.email += '@hcmussh.edu.vn'
                                }
                            }
                        }"
                        class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Email
                            </div>
                            <input type="search" 
                            x-model="thinhgiang.email"
                            @focusout="checkemail()"
                            @keyup.enter="checkemail()"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>

                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Số điện thoại
                            </div>
                            <input type="search" 
                            value="0123456789"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>
                    </div>
                    <div class="text-[16px] text-black font-[500] mt-[10px]">
                        Trình độ học vấn
                    </div>
                    <div class="w-full flex flex-row justify-start items-start gap-6">

                        <!-- học vị -->
                        <div x-data="{
                            showoptions: false,
                            output: [],
                            dataframe: [],
                            research: '',
                            backspace: true,
                            choose: 0,
                            miniSearch,
                            getData() {
                                this.miniSearch = new MiniSearch({
                                    fields: ['value'],
                                    searchOptions: {
                                        prefix: true,
                                        combineWith: 'AND',
                                    }
                                })
                                fetch('/api/danhmuc/hocvi')            
                                .then((response) => response.json())
                                .then((result) => {
                                    this.dataframe = result.reduce((byId, song) => {
                                        byId[song.id] = song;
                                        return byId;
                                    }, {});
                                    this.output = Object.values(this.dataframe);
                                    this.miniSearch.addAll(result);
                                });
                            },
                            filteredItems() {
                                this.showoptions = true;
                                if (thinhgiang.hocvi) {
                                    this.output = this.miniSearch.search(thinhgiang.hocvi).map(({ id }) => this.dataframe[id])
                                } else {
                                    this.output = Object.values(this.dataframe);
                                }
                            },
                            addItem(item) {
                                thinhgiang.hocvi = item.value;
                                this.showoptions = false;
                                $dispatch('hocvi');
                            },
                            checkItem() {
                                this.filteredItems()
                                if (this.output.length >= 1) {
                                    if (thinhgiang.hocvi != this.output[0].value) {
                                        thinhgiang.hocvi = ''
                                    }
                                } else {
                                    thinhgiang.hocvi = ''
                                }
                            },
                            enterEvent() {
                                if (this.output) {
                                    this.addItem(this.output[this.choose])
                                } else {
                                    thinhgiang.hocvi = ''
                                }
                            },
                            eventBackspace() {
                                this.backspace = true;
                            },
                            showoptionscheck(e) {
                                if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                    this.choose = 0;
                                }
                            },
                            focusinputcheck() {
                                this.filteredItems();
                                this.showoptions = true;
                            },
                            checkchoose(index) {
                                return index === this.choose
                            },
                            selectoption(type) {
                                if (type === 'up' && this.choose > 0) {
                                    this.choose = this.choose - 1
                                    item = document.getElementById('hocvi'+this.choose).getBoundingClientRect()
                                    frame = $refs.hocvi.getBoundingClientRect()
                                    if ((item.bottom - frame.top) < item.height) {
                                        $refs.hocvi.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                    }
                                } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                    this.choose = this.choose + 1
                                    item = document.getElementById('hocvi'+this.choose).getBoundingClientRect()
                                    frame = $refs.hocvi.getBoundingClientRect()
                                    if ((frame.bottom - item.top) < item.height) {
                                        $refs.hocvi.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                    }
                                }
                            }
                        }" x-init="getData()"
                        class="basis-[25%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Học vị
                            </div>
                            <input type="search"
                            @focusout.debounce.100ms="checkItem();showoptions = false;"
                            @keyup.enter="enterEvent()"
                            @keydown.up.prevent.throttle.100ms="selectoption('up')"
                            @keydown.down.prevent.throttle.100ms="selectoption('down')"
                            @keyup.up.prevent
                            @keyup.down.prevent
                            x-ref="input"
                            @focus="focusinputcheck()"
                            @keyup = 'showoptionscheck'
                            @keyup.backspace="eventBackspace"
                            x-model="thinhgiang.hocvi"
                            @input="filteredItems()"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">

                            <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                <ul x-ref="hocvi" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[200px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                    <template x-if="output.length === 0">
                                        <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                    </template>
                                    <template x-for="(item, index) in output" :key="item.id">
                                        <li x-text="item.value"
                                        :id="'hocvi'+index"
                                        @click="addItem(item)"
                                        @mouseover="choose = index"
                                        :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                        class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                    </template>
                                </ul>
                            </div>
                        
                        </div>
                        <!-- end học vị -->

                        <!-- chuyên ngành -->
                        <div x-data="{
                            showoptions: false,
                            output: [],
                            dataframe: [],
                            research: '',
                            backspace: true,
                            choose: 0,
                            miniSearch,
                            async updateData() {
                                switch (thinhgiang.hocvi) {
                                    case 'Cử nhân':
                                        url = '/api/danhmuc/nganh-daihoc';
                                        break;
                                    case 'Thạc sĩ':
                                        url = '/api/danhmuc/nganh-thacsi';
                                        break;
                                    case 'Tiến sĩ':
                                        url = '/api/danhmuc/nganh-tiensi';
                                        break;
                                    case 'Tiến sĩ khoa học':
                                        url = '/api/danhmuc/nganh-tiensi';
                                        break;
                                    default:
                                        url = '/api/danhmuc/nganh-thacsi';
                                }
                                fetch(url)            
                                .then((response) => response.json())
                                .then((result) => {
                                    this.dataframe = result.reduce((byId, song) => {
                                        byId[song.id] = song;
                                        return byId;
                                    }, {});
                                    this.output = Object.values(this.dataframe);
                                    this.miniSearch.removeAll();
                                    this.miniSearch.addAll(result);
                                });
                            },
                            getData() {
                                this.miniSearch = new MiniSearch({
                                    fields: ['value'],
                                    searchOptions: {
                                        prefix: true,
                                        combineWith: 'AND'
                                    }
                                })
                                this.updateData()
                            },
                            filteredItems() {
                                this.showoptions = true;
                                if (thinhgiang.hocvi_nganh) {
                                    this.output = this.miniSearch.search(thinhgiang.hocvi_nganh).map(({ id }) => this.dataframe[id])
                                } else {
                                    this.output = Object.values(this.dataframe);
                                }
                            },
                            addItem(item) {
                                thinhgiang.hocvi_nganh = item.value;
                                this.showoptions = false;
                            },
                            checkItem() {
                                this.filteredItems()
                                if (this.output.length >= 1) {
                                    if (thinhgiang.hocvi_nganh != this.output[0].value) {
                                        thinhgiang.hocvi_nganh = ''
                                    }
                                } else {
                                    thinhgiang.hocvi_nganh = ''
                                }
                            },
                            enterEvent() {
                                if (this.output) {
                                    this.addItem(this.output[this.choose])
                                } else {
                                    thinhgiang.hocvi_nganh = ''
                                }
                            },
                            eventBackspace() {
                                this.backspace = true;
                            },
                            showoptionscheck(e) {
                                if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                    this.choose = 0;
                                }
                            },
                            focusinputcheck() {
                                this.filteredItems();
                                this.showoptions = true;
                            },
                            checkchoose(index) {
                                return index === this.choose
                            },
                            selectoption(type) {
                                if (type === 'up' && this.choose > 0) {
                                    this.choose = this.choose - 1
                                    item = document.getElementById('hocvi_nganh'+this.choose).getBoundingClientRect()
                                    frame = $refs.hocvi_nganh.getBoundingClientRect()
                                    if ((item.bottom - frame.top) < item.height) {
                                        $refs.hocvi_nganh.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                    }
                                } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                    this.choose = this.choose + 1
                                    item = document.getElementById('hocvi_nganh'+this.choose).getBoundingClientRect()
                                    frame = $refs.hocvi_nganh.getBoundingClientRect()
                                    if ((frame.bottom - item.top) < item.height) {
                                        $refs.hocvi_nganh.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                    }
                                }
                            }
                        }" x-init="getData()" @hocvi.window="updateData()"
                        class="basis-[75%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Chuyên ngành
                            </div>
                            <input type="search"
                            @focusout.debounce.100ms="checkItem();showoptions = false;"
                            @keyup.enter="enterEvent()"
                            @keydown.up.prevent.throttle.100ms="selectoption('up')"
                            @keydown.down.prevent.throttle.100ms="selectoption('down')"
                            @keyup.up.prevent
                            @keyup.down.prevent
                            x-ref="input"
                            @focus="focusinputcheck()"
                            @keyup = 'showoptionscheck'
                            @keyup.backspace="eventBackspace"
                            x-model="thinhgiang.hocvi_nganh"
                            @input="filteredItems()"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">

                            <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                <ul x-ref="hocvi_nganh" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[560px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                    <template x-if="output.length === 0">
                                        <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                    </template>
                                    <template x-for="(item, index) in output" :key="item.id">
                                        <li x-text="item.value"
                                        :id="'hocvi_nganh'+index"
                                        @click="addItem(item)"
                                        @mouseover="choose = index"
                                        :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                        class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                    </template>
                                </ul>
                            </div>
                        
                        </div>
                        <!-- end chuyên ngành -->
                    </div>
                    <div class="w-full flex flex-row justify-start items-start gap-6">


                        <!-- học hàm -->
                        <div x-data="{
                            showoptions: false,
                            output: [],
                            items: [{id:1,value:'Phó giáo sư'},{id:2,value:'Giáo sư'}],
                            dataframe: [],
                            research: '',
                            backspace: true,
                            choose: 0,
                            miniSearch,
                            getData() {
                                this.miniSearch = new MiniSearch({
                                    fields: ['value'],
                                    searchOptions: {
                                        prefix: true,
                                        combineWith: 'AND',
                                    }
                                })
                                fetch('/api/danhmuc/hocham')            
                                .then((response) => response.json())
                                .then((result) => {
                                    this.dataframe = result.reduce((byId, song) => {
                                        byId[song.id] = song;
                                        return byId;
                                    }, {});
                                    this.output = Object.values(this.dataframe);
                                    this.miniSearch.addAll(result);
                                });
                            },
                            filteredItems() {
                                this.showoptions = true;
                                if (thinhgiang.hocham) {
                                    this.output = this.miniSearch.search(thinhgiang.hocham).map(({ id }) => this.dataframe[id])
                                } else {
                                    this.output = Object.values(this.dataframe);
                                }
                            },
                            addItem(item) {
                                thinhgiang.hocham = item.value;
                                this.showoptions = false;
                            },
                            checkItem() {
                                this.filteredItems();
                                if (this.output.length >= 1) {
                                    if (thinhgiang.hocham != this.output[0].value) {
                                        thinhgiang.hocham = ''
                                    }
                                } else {
                                    thinhgiang.hocham = ''
                                }
                                this.showoptions = false;
                                
                            },
                            enterEvent() {
                                if (this.output) {
                                    this.addItem(this.output[this.choose])
                                } else {
                                    thinhgiang.hocham = ''
                                }
                            },
                            eventBackspace() {
                                this.backspace = true;
                            },
                            showoptionscheck(e) {
                                if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                    this.choose = 0;
                                }
                            },
                            focusinputcheck() {
                                this.filteredItems();
                                this.showoptions = true;
                            },
                            checkchoose(index) {
                                return index === this.choose
                            },
                            selectoption(type) {
                                if (type === 'up' && this.choose > 0) {
                                    this.choose = this.choose - 1
                                    item = document.getElementById('hocham'+this.choose).getBoundingClientRect()
                                    frame = $refs.hocham.getBoundingClientRect()
                                    if ((item.bottom - frame.top) < item.height) {
                                        $refs.hocham.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                    }
                                } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                    this.choose = this.choose + 1
                                    item = document.getElementById('hocham'+this.choose).getBoundingClientRect()
                                    frame = $refs.hocham.getBoundingClientRect()
                                    if ((frame.bottom - item.top) < item.height) {
                                        $refs.hocham.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                    }
                                }
                            }
                        }" x-init="getData()"
                        class="basis-[25%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Học hàm
                            </div>
                            <input type="search"
                            @focusout.debounce.100ms="checkItem()"
                            @keyup.enter="enterEvent()"
                            @keydown.up.prevent.throttle.100ms="selectoption('up')"
                            @keydown.down.prevent.throttle.100ms="selectoption('down')"
                            @keyup.up.prevent
                            @keyup.down.prevent
                            x-ref="input"
                            @focus="focusinputcheck()"
                            @keyup = 'showoptionscheck'
                            @keyup.backspace="eventBackspace"
                            x-model="thinhgiang.hocham"
                            @input="filteredItems()"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">

                            <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                <ul x-ref="hocham" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[200px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                    <template x-if="output.length === 0">
                                        <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                    </template>
                                    <template x-for="(item, index) in output" :key="item.id">
                                        <li x-text="item.value"
                                        :id="'hocham'+index"
                                        @click="addItem(item)"
                                        @mouseover="choose = index"
                                        :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                        class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                    </template>
                                </ul>
                            </div>
                        </div>
                        <!-- end học hàm -->


                        <!-- chuyên ngành học hàm -->
                        <div x-data="{
                            showoptions: false,
                            output: [],
                            dataframe: [],
                            research: '',
                            backspace: true,
                            choose: 0,
                            miniSearch,
                            getData() {
                                this.miniSearch = new MiniSearch({
                                    fields: ['value'],
                                    searchOptions: {
                                        prefix: true,
                                        combineWith: 'AND',
                                    }
                                })
                                fetch('/api/danhmuc/nganh-gs-pgs')            
                                .then((response) => response.json())
                                .then((result) => {
                                    this.dataframe = result.reduce((byId, song) => {
                                        byId[song.id] = song;
                                        return byId;
                                    }, {});
                                    this.output = Object.values(this.dataframe);
                                    this.miniSearch.addAll(result);
                                });
                            },
                            filteredItems() {
                                this.showoptions = true;
                                if (thinhgiang.hocham_nganh) {
                                    this.output = this.miniSearch.search(thinhgiang.hocham_nganh).map(({ id }) => this.dataframe[id])
                                } else {
                                    this.output = Object.values(this.dataframe);
                                }
                            },
                            addItem(item) {
                                thinhgiang.hocham_nganh = item.value;
                                this.showoptions = false;
                            },
                            checkItem() {
                                this.filteredItems()
                                if (this.output.length >= 1) {
                                    if (thinhgiang.hocham_nganh != this.output[0].value) {
                                        thinhgiang.hocham_nganh = ''
                                    }
                                } else {
                                    thinhgiang.hocham_nganh = ''
                                }
                            },
                            enterEvent() {
                                if (this.output) {
                                    this.addItem(this.output[this.choose])
                                } else {
                                    thinhgiang.hocham_nganh = ''
                                }
                            },
                            eventBackspace() {
                                this.backspace = true;
                            },
                            showoptionscheck(e) {
                                if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                    this.choose = 0;
                                }
                            },
                            focusinputcheck() {
                                this.filteredItems();
                                this.showoptions = true;
                            },
                            checkchoose(index) {
                                return index === this.choose
                            },
                            selectoption(type) {
                                if (type === 'up' && this.choose > 0) {
                                    this.choose = this.choose - 1
                                    item = document.getElementById('hocham_nganh'+this.choose).getBoundingClientRect()
                                    frame = $refs.hocham_nganh.getBoundingClientRect()
                                    if ((item.bottom - frame.top) < item.height) {
                                        $refs.hocham_nganh.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                    }
                                } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                    this.choose = this.choose + 1
                                    item = document.getElementById('hocham_nganh'+this.choose).getBoundingClientRect()
                                    frame = $refs.hocham_nganh.getBoundingClientRect()
                                    if ((frame.bottom - item.top) < item.height) {
                                        $refs.hocham_nganh.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                    }
                                }
                            }
                        }" x-init="getData()"
                        class="basis-[75%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Ngành
                            </div>
                            <input type="search"
                            @focusout.debounce.100ms="checkItem();showoptions = false;"
                            @keyup.enter="enterEvent()"
                            @keydown.up.prevent.throttle.100ms="selectoption('up')"
                            @keydown.down.prevent.throttle.100ms="selectoption('down')"
                            @keyup.up.prevent
                            @keyup.down.prevent
                            x-ref="input"
                            @focus="focusinputcheck()"
                            @keyup = 'showoptionscheck'
                            @keyup.backspace="eventBackspace"
                            x-model="thinhgiang.hocham_nganh"
                            @input="filteredItems()"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">

                            <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                <ul x-ref="hocham_nganh" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[560px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                    <template x-if="output.length === 0">
                                        <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                    </template>
                                    <template x-for="(item, index) in output" :key="item.id">
                                        <li x-text="item.value"
                                        :id="'hocham_nganh'+index"
                                        @click="addItem(item)"
                                        @mouseover="choose = index"
                                        :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                        class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                    </template>
                                </ul>
                            </div>
                        </div>
                        <!-- end chuyên ngành học hàm -->
                    </div>
                    <div class="text-[16px] text-black font-[500] mt-[10px]">
                        Thông tin Công tác
                    </div>


                    <div class="w-full flex flex-row justify-start items-start gap-6">
                        <!-- {# Đơn vị mời giảng #} -->
                        <div id="donvi" class="w-full h-auto flex flex-row justify-center items-start">
                            <div x-data="{
                                showoptions: false,
                                items: [
                                {id:1,value:'Khoa Ngữ văn Tây Ban Nha - Italia'},
                                {id:2,value:'Khoa Triết học'},
                                {id:3,value:'Khoa Thư viện - Thông tin học'},
                                {id:4,value:'Khoa Báo chí và Truyền thông'},
                                {id:5,value:'Khoa Văn học'},
                                {id:6,value:'Khoa Nhân học'},
                                {id:7,value:'Khoa Ngữ văn Anh'},
                                {id:8,value:'Khoa Ngữ văn Nga'},
                                {id:9,value:'Khoa Nhật Bản học'}
                                ],
                                dataframe: [],
                                output: [],
                                results: [],
                                search: '',
                                research: '',
                                backspace: true,
                                choose: 0,
                                miniSearch,
                                getData() {
                                    this.miniSearch = new MiniSearch({
                                        fields: ['value'],
                                        searchOptions: {
                                            prefix: true,
                                            combineWith: 'AND',
                                        }
                                    })
                                    fetch('/api/danhmuc/donvi')            
                                    .then((response) => response.json())
                                    .then((result) => {
                                        this.dataframe = result.reduce((byId, song) => {
                                            byId[song.id] = song;
                                            return byId;
                                        }, {});
                                        this.output = Object.values(this.dataframe);
                                        this.miniSearch.addAll(result);
                                    });
                                },
                                filteredItems() {
                                    this.showoptions = true;
                                    if (this.search) {
                                        this.output = this.miniSearch.search(this.search).map(({ id }) => this.dataframe[id])
                                    } else {
                                        this.output = Object.values(this.dataframe);
                                    }
                                },
                                get checkresults() {
                                    return this.results.length === 0
                                },
                                addItem(value) {
                                    console.log(value);
                                    this.miniSearch.remove(value);
                                    delete this.dataframe[value.id]
                                    this.results.push(value);
                                    this.search = '';
                                    this.filteredItems();
                                    this.showoptions = false;
                                    
                                },
                                removeItem(value) {
                                    console.log(value);
                                    this.results = this.results.filter(i => i !== value);
                                    this.miniSearch.add(value);
                                    this.dataframe[value.id] = value;
                                    this.filteredItems();
                                    this.showoptions = false;
                                },
                                checkItem() {
                                    this.search = ''  
                                },
                                enterEvent() {
                                    if (this.output[this.choose] && this.showoptions) {
                                        this.addItem(this.output[this.choose])
                                    } else {
                                        this.search = ''
                                        this.choose = 0;
                                        this.filteredItems();
                                    }
                                },
                                eventBackspace() {
                                    this.backspace = true;
                                },
                                checkdown() {
                                    if (this.backspace === true) {
                                        this.research = this.search;
                                        this.backspace = false;
                                        if (this.research === '' && this.results.length > 0) {
                                            value = this.results.at(-1);
                                            this.removeItem(value)
                                        }
                                    }
                                },
                                showoptionscheck(e) {
                                    if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                        this.choose = 0;
                                    }
                                },
                                focusinputcheck() {
                                    this.filteredItems();
                                    this.showoptions = true;
                                },
                                checkchoose(index) {
                                    return index === this.choose
                                },
                                selectoption(type) {
                                    if (type === 'up' && this.choose > 0) {
                                        this.choose = this.choose - 1
                                        item = document.getElementById('donvi'+this.choose).getBoundingClientRect()
                                        frame = $refs.donvi.getBoundingClientRect()
                                        if ((item.bottom - frame.top) < item.height) {
                                            $refs.donvi.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                        }
                                    } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                        this.choose = this.choose + 1
                                        item = document.getElementById('donvi'+this.choose).getBoundingClientRect()
                                        frame = $refs.donvi.getBoundingClientRect()
                                        if ((frame.bottom - item.top) < item.height) {
                                            $refs.donvi.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                        }
                                    }
                                }
                            }" x-init="getData()"
                            class="w-full flex flex-col justify-start items-start gap-2">
                                <div>
                                    Đơn vị mời giảng
                                </div>
                                <div x-ref="divinput"
                                @focusout.debounce.100ms="showoptions = false;"
                                @click.self="$refs.input.focus()"
                                class="cursor-text basis-[100%] w-full shrink relative rounded-lg flex flex-row justify-start items-start flex-wrap py-[12px] gap-2 bg-gray-100 p-[15px]">
                                    <template x-for="result in results" :key="result.id">
                                        <div class="text-[15px] bg-[#ff4b4b] rounded-md text-white px-[15px] py-[3px] cursor-default flex flex-row items-center relative">
                                            <div x-text="result.value"></div>
                                            <i @click="removeItem(result)"
                                            class="fa-solid fa-xmark cursor-pointer pl-[10px]"></i>
                                        </div>
                                    </template>
                                    <div class="rounded-lg overflow-hidden relative w-auto max-w-[100%] h-[25px] flex flex-row justify-start">
                                        <span x-text="search + 'a'" 
                                        x-ref="span" 
                                        class="invisible text-[15px] p-0"></span>
                                        <input type="text"
                                        @focusout.debounce.100ms="checkItem()"
                                        @keyup.enter="enterEvent()"
                                        @keydown.up.prevent.throttle.100ms="selectoption('up')"
                                        @keydown.down.prevent.throttle.100ms="selectoption('down')"
                                        @keyup.up.prevent
                                        @keyup.down.prevent
                                        class="bg-gray-100 p-0 w-[100%] absolute left-0 text-[15px] py-[5px] border-transparent focus:border-transparent focus:ring-0 top-[50%] translate-y-[-50%]"
                                        x-ref="input"
                                        x-model="search"
                                        @input="filteredItems()"
                                        @focus="focusinputcheck()"
                                        @keydown.backspace="checkdown()"
                                        @keyup = 'showoptionscheck'
                                        @keyup.backspace="eventBackspace"/>
                                    </div>
                                </div>

                                <div x-show="showoptions" x-anchor.bottom="$refs.divinput" class="z-[1] transition-none">
                                    <ul x-ref="donvi" class="shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[770px] h-auto max-h-[200px] flex flex-col overflow-auto">
                                        <template x-if="output.length === 0">
                                            <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                        </template>
                                        <template x-for="(item, index) in output" :key="item.id">
                                            <li x-text="item.value"
                                            :id="'donvi'+index"
                                            @click="addItem(item)"
                                            @mouseover="choose = index"
                                            :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                            class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                        </template>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- End Đơn vị mời giảng -->
                    </div>


                    <div class="w-full flex flex-row justify-start items-start gap-6">



                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Đơn vị công tác chính
                            </div>
                            <input type="text" 
                            x-model="thinhgiang.donvicongtac"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>


                        <!-- chức danh nghề nghiệp chính -->
                        <div x-data="{
                            showoptions: false,
                            output: [],
                            items: [{id:1,value:'Phó giáo sư'},{id:2,value:'Giáo sư'}],
                            dataframe: [],
                            research: '',
                            backspace: true,
                            choose: 0,
                            miniSearch,
                            getData() {
                                this.miniSearch = new MiniSearch({
                                    fields: ['value'],
                                    searchOptions: {
                                        prefix: true,
                                        combineWith: 'AND',
                                    }
                                })
                                fetch('/api/danhmuc/chucdanh')            
                                .then((response) => response.json())
                                .then((result) => {
                                    this.dataframe = result.reduce((byId, song) => {
                                        byId[song.id] = song;
                                        return byId;
                                    }, {});
                                    this.output = Object.values(this.dataframe);
                                    this.miniSearch.addAll(result);
                                });
                            },
                            filteredItems() {
                                this.showoptions = true;
                                if (thinhgiang.chucdanh) {
                                    this.output = this.miniSearch.search(thinhgiang.chucdanh).map(({ id }) => this.dataframe[id])
                                } else {
                                    this.output = Object.values(this.dataframe);
                                }
                            },
                            addItem(item) {
                                thinhgiang.chucdanh = item.value;
                                this.showoptions = false;
                            },
                            checkItem() {
                                this.filteredItems()
                                if (this.output.length >= 1) {
                                    if (thinhgiang.chucdanh != this.output[0].value) {
                                        thinhgiang.chucdanh = ''
                                    }
                                } else {
                                    thinhgiang.chucdanh = ''
                                }
                            },
                            enterEvent() {
                                if (this.output) {
                                    this.addItem(this.output[this.choose])
                                } else {
                                    thinhgiang.chucdanh = ''
                                }
                            },
                            eventBackspace() {
                                this.backspace = true;
                            },
                            showoptionscheck(e) {
                                if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                    this.choose = 0;
                                }
                            },
                            focusinputcheck() {
                                this.filteredItems();
                                this.showoptions = true;
                            },
                            checkchoose(index) {
                                return index === this.choose
                            },
                            selectoption(type) {
                                if (type === 'up' && this.choose > 0) {
                                    this.choose = this.choose - 1
                                    item = document.getElementById('chucdanh'+this.choose).getBoundingClientRect()
                                    frame = $refs.chucdanh.getBoundingClientRect()
                                    if ((item.bottom - frame.top) < item.height) {
                                        $refs.chucdanh.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                    }
                                } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                    this.choose = this.choose + 1
                                    item = document.getElementById('chucdanh'+this.choose).getBoundingClientRect()
                                    frame = $refs.chucdanh.getBoundingClientRect()
                                    if ((frame.bottom - item.top) < item.height) {
                                        $refs.chucdanh.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                    }
                                }
                            }
                        }" x-init="getData()"
                        class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Chức danh nghề nghiệp chính
                            </div>
                            <input type="search"
                            @focusout.debounce.100ms="checkItem();showoptions = false;"
                            @keyup.enter="enterEvent()"
                            @keydown.up.prevent.throttle.100ms="selectoption('up')"
                            @keydown.down.prevent.throttle.100ms="selectoption('down')"
                            @keyup.up.prevent
                            @keyup.down.prevent
                            x-ref="input"
                            @focus="focusinputcheck()"
                            @keyup = 'showoptionscheck'
                            @keyup.backspace="eventBackspace"
                            x-model="thinhgiang.chucdanh"
                            @input="filteredItems()"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">

                            <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                <ul x-ref="chucdanh" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[385px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                    <template x-if="output.length === 0">
                                        <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                    </template>
                                    <template x-for="(item, index) in output" :key="item.id">
                                        <li x-text="item.value"
                                        :id="'chucdanh'+index"
                                        @click="addItem(item)"
                                        @mouseover="choose = index"
                                        :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                        class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                    </template>
                                </ul>
                            </div>
                        </div>
                        <!-- end chức danh nghề nghiệp chính -->



                    </div>
                    <div class="w-full border my-[15px]"></div>
                </div>
                <!-- end noi dung -->

                <!-- button -->
                <div>
                    <div class="w-full shrink flex flex-row justify-center items-start gap-2 text-[16px] mt-[10px]">
                        <input type="button" 
                        value="Cập nhật"
                        @click="{id, ...thinhgiangg} = thinhgiang; 
                        fetch(`/api/nhansu/thinhgiang/update?id=${thinhgiang.id}`,
                        {method:'POST',
                        headers:{'Content-Type': 'application/json',},
                        body: JSON.stringify({...thinhgiangg})})
                        .then((response) => {
                            console.log(response)
                        });"
                        class="bg-orange text-white py-[10px] px-[15px] rounded-md cursor-pointer font-[500]">
                    </div>
                </div>
                <!-- end button -->
            </div>
        </div>
        <!-- end hoso -->



        <!-- {# Điều chỉnh #} -->
        <div class="fixed bottom-[50%] right-[10px] flex flex-col justify-center items-center gap-2">
            <div x-data 
            @click="$dispatch('newportfolio')"
            class="w-[40px] h-[40px] bg-orange text-white text-[18px] font-[500] px-[12px] py-[12px] rounded-full flex justify-center items-center gap-2 cursor-pointer">
                <i class="fa-solid fa-plus"></i>
            </div>
            <div x-data 
            @click="$dispatch('modify')"
            class="w-[40px] h-[40px] bg-orange text-white text-[18px] font-[500] px-[12px] py-[12px] rounded-full flex justify-center items-center gap-2 cursor-pointer">
                <i class="fa-solid fa-arrow-up"></i>
            </div>
        </div>
        <!-- {# End Điều chỉnh #} -->


        <!-- {# download/upload #} -->
        <div x-data="{open: false}" @modify.window="open = ! open" class="fixed left-0 top-0 z-[2000]">
            <div x-show="open" 
            @click="open = ! open; $dispatch('closepopup'); htmx.trigger('#upload-form', 'htmx:abort')" 
            @keyup.escape.window="open = ! open; $dispatch('closepopup'); htmx.trigger('#upload-form', 'htmx:abort')" 
            class="w-screen h-screen bg-black opacity-70"></div>
            <div x-show="open" class="rounded-xl overflow-hidden fixed top-[50%] translate-y-[-50%] left-[50%] translate-x-[-50%] w-[500px] h-[400px] bg-white opacity-100">
                <div id="form" 
                hx-trigger="modify from:body"
                hx-get="/template/nhansu/form/upload"
                hx-ext="alpine-morph"
                hx-swap="multi:#form:morph"
                class="w-full h-full flex justify-center items-center">
                    <div class="htmx-indicator flex flex-col gap-6 w-[400px]">
                        <div class="skeleton h-32 w-full"></div>
                        <div class="skeleton h-4 w-28"></div>
                        <div class="skeleton h-4 w-full"></div>
                        <div class="skeleton h-4 w-full"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- {# End download/upload #} -->

    </div>  
</div>