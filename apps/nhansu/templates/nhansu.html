<title id="title">Nhân sự | TCCB - USSH</title>

<div id="boder" class="basis-full shrink overflow-y-hidden overflow-x-hidden flex flex-col justify-start items-center">
    <div id="container" 
    x-ref="container"
    x-data="{
        search: '',
        dataframe: {},
        output: [],
        isLoading: false,
        miniSearch: '',
        getSearchResults() {
            if (this.search === '') {
                this.output = Object.values(this.dataframe);
            } else {
                this.output = this.miniSearch.search(this.search).map(({ id }) => this.dataframe[id])
            }
        },
        async getData() {
            this.miniSearch = new MiniSearch({
                fields: ['maso','hovaten','ngaysinh'],
                searchOptions: {
                    prefix: true,
                    combineWith: 'AND',
                },
                extractField: (document, fieldName) => {
                    if (fieldName === 'maso') {
                        const nguyen = document['maso']
                        if (nguyen) {
                            return nguyen && nguyen + ' ' + nguyen.slice(6) + ' ' + nguyen.slice(3)
                        }
                    }
                    return fieldName.split('.').reduce((doc, key) => doc && doc[key], document)
                },
            })
            this.isLoading = true;
            fetch('/api/nhansu/search')            
                .then((response) => response.json())
                .then((result) => { 
                    this.dataframe = result.reduce((byId, song) => {
                        byId[song.id] = song;
                        return byId;
                    }, {});
                    this.output = Object.values(this.dataframe);
                    this.miniSearch.addAll(result);
                    this.isLoading = false;
                });
        }
    }"
    x-init="getData()"
    class="overflow-auto w-full h-full flex flex-col justify-start items-center px-[30px] py-[15px] gap-2">
        <div class="w-full flex flex-row justify-center items-center shrink-0">

            <!-- {# Trang chủ/nhân sự #}
            <div class="w-[150px] flex flex-col justify-start items-start">
            </div>
            {# End Trang chủ/nhân sự #} -->


            {# Search #}
            <div class="w-[500px] h-[50px] rounded-3xl bg-gray-100 flex flex-row justify-start items-center mb-[20px]">
                <div class="basis-[50px] shrink-0 rounded-full">
                    <i class="fa-solid fa-magnifying-glass text-[14px] text-gray-400"></i>
                </div>
                <input x-model="search"
                @input="getSearchResults()"
                class="transition-none bg-gray-100 p-0 rounded-r-3xl basis-[87%] shrink text-[16px] border-transparent focus:border-transparent focus:ring-0" 
                type="search">
            </div>
            {# End search #}

        </div>


        <!-- {# Hashtags #}
        <div id="hashtags" class="z-[2] w-full h-auto mb-[15px] flex flex-row justify-center items-start">
            <div x-data="{
                focusinput: false,
                showoptions: false,
                items: ['banana','bababa','bahaha','mango','apple','orange','chili','lemon','sdfsfssfdsfs','wetrtwrfggsferwete','ghtyutyutyesrtedfsrw'],
                results: [],
                search: '',
                research: '',
                backspace: true,
                choose: 0,
                get filteredItems() {
                    if (this.search !== '') {
                        return this.items.filter(
                            i => i.startsWith(this.search)
                        )
                    } else {
                        return []
                    }
  
                },
                get checkresults() {
                    return this.results.length === 0
                },
                addItem(value) {
                    console.log(value);
                    this.items = this.items.filter(i => i !== value);
                    this.results.push(value); 
                    this.search = '';
                    this.showoptions = false;
                },
                removeItem(value) {
                    console.log(value);
                    this.results = this.results.filter(i => i !== value);
                    this.items.push(value);
                },
                checkItem() {
                    if (this.filteredItems.length == 0) {
                        this.search = ''
                    }     
                },
                enterEvent() {
                    if (typeof this.filteredItems[this.choose] !== 'undefined') {
                        this.addItem(this.filteredItems[this.choose])
                    } else {
                        this.search = ''
                    }
                },
                eventBackspace() {
                    this.backspace = true;
                },
                checkdown() {
                    if (this.backspace === true) {
                        this.research = this.search;
                        this.backspace = false;
                        if (this.research === '' && this.results.length > 0) {
                            value = this.results.at(-1);
                            this.results = this.results.filter(i => i !== value);
                            this.items.push(value);
                     
                        }
                    }
                },
                showoptionscheck(e) {
                    if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                        this.choose = 0;
                    }
                    if (this.search !== '' && this.focusinput == true) {
                        this.showoptions = true;
                    } else {
                        this.showoptions = false;
                    }
                },
                focusinputcheck() {
                    this.focusinput = true;
                    if (this.search !== '') {
                        this.showoptions = true;
                    }
                },
                checkchoose(index) {
                    return index === this.choose
                },
                selectoption(type) {
                    if (type === 'up' && this.choose > 0) {
                        this.choose = this.choose - 1
                    } else if (type === 'down' && this.choose < (this.filteredItems.length - 1)) {
                        this.choose = this.choose + 1
                    }
                }
            }"
            class="w-[600px]"
            @click.outside="focusinput = false; showoptions = false;">

                <div x-ref="divinput"
                class="relative rounded-lg w-full flex flex-row justify-center items-start flex-wrap py-[8px] px-[15px] gap-2">
                        {# <i class="absolute top-[10px] left-[5px] text-gray-300 text-[20px] fa-solid fa-hashtag"></i> #}
                        <div :class="checkresults ? 'bg-[#ff4b4b]' : 'bg-gray-400'"
                        class="text-[13px]  rounded-md text-white px-[10px] py-[2px] cursor-default flex flex-row items-center relative">
                            <div># Tất cả</div>
                        </div>
                    <template x-for="result in results" :key="result">
                        <div class="text-[13px] bg-[#ff4b4b] rounded-md text-white px-[10px] py-[2px] cursor-default flex flex-row items-center relative">
                            <div x-text="'# ' + result"></div>
                            <i @click="removeItem(result)"
                            class="fa-solid fa-xmark cursor-pointer pl-[10px]"></i>
                        </div>
                    </template>
                    <div class="rounded-lg border border-orange overflow-hidden relative px-[10px] min-w-[100px] w-auto max-w-[100%] h-[25px] flex flex-row justify-start">
                        <span x-text="search + 'a'" 
                        x-ref="span" 
                        class="invisible text-[14px] p-0"></span>
                        <input type="text" 
                        placeholder="Nhập tag..."
                        @click.outside="checkItem()"
                        @keyup.enter="enterEvent()"
                        @keydown.up.prevent.throttle.100ms="selectoption('up')"
                        @keydown.down.prevent.throttle.100ms="selectoption('down')"
                        @keyup.up.prevent
                        @keyup.down.prevent
                        class="w-[100%] absolute px-[10px] left-0 text-[14px] py-[5px] border-transparent focus:border-transparent focus:ring-0 top-[50%] translate-y-[-50%]"
                        x-ref="input"
                        x-model="search"
                        @focus="focusinputcheck()"
                        @keydown.backspace="checkdown()"
                        @keyup = 'showoptionscheck'
                        @keyup.backspace="eventBackspace"/>
                    </div>
                </div>

                <div x-show="showoptions" x-anchor.bottom="$refs.input">
                    <ul class="shadow-xl bg-white rounded-lg w-[300px] h-auto flex flex-col overflow-hidden">
                        <template x-if="filteredItems.length === 0">
                            <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                        </template>
                        <template x-for="(item, index) in filteredItems" :key="item">
                            <li x-text="item"
                            @click="addItem(item)"
                            @mouseover="choose = index"
                            :class="checkchoose(index) ? 'bg-gray-100' : ''"
                            class="text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                        </template>
                    </ul>
                </div>
            </div>
        </div>
        {# End Hashtags #} -->

        <!-- tabs row-->
        <div id="tabs" 
        x-data="{tab1Active: true, tab2Active: false}"
        class="z-[1] relative rounded-md w-full max-w-[1000px] flex flex-row justify-start items-start border">
            <div id="tab" 
            :class="tab1Active ? 'border-b-2 border-b-orange font-[500] shadow-md' : 'hover:bg-gray-100'"
            @click="$dispatch('tab1'); tab1Active = true; tab2Active = false"
            class="p-[10px] cursor-pointer">Nhân sự trong Trường</div>
            <div id="tab2"
            :class="tab2Active ? 'border-b-2 border-b-orange font-[500] shadow-md' : 'hover:bg-gray-100'"
            @click="$dispatch('tab2'); tab1Active = false; tab2Active = true"
            class="p-[10px] cursor-pointer">Nhân sự ngoài Trường</div>
        </div>
        <!-- end tabs row -->

        <!-- tab 1 -->
        <div x-data="{show:true}"
        @tab2.window="show = false"
        @tab1.window="show = true"
        x-show="show"
        class="w-full max-w-[1000px]">
        TAB NHANSU IN TRUONG - COMMING SOON...
        </div>

        <!-- tab 2 -->
        <div x-data="{show:false}"
        @tab2.window="show = true"
        @tab1.window="show = false"
        x-show="show"
        class="w-full max-w-[1000px]">
            {# Table #}
            <div id="table" class="z-[1] shadow-lg relative rounded-lg w-full max-w-[1000px] flex flex-col justify-start text-left">
                <!-- head of table -->
                <div id="thead" 
                class="sticky top-[-15px] w-full min-w-[750px] flex flex-row bg-gray-200 text-black font-[700] rounded-t-lg z-[1]">
                    <div class="w-[5%] min-w-[50px] flex flex-row justify-start items-center">
                        <div class="p-[15px]">#</div>
                    </div>
                    <div class="w-[15%] min-w-[100px] flex flex-row justify-start items-center">
                        <div class="py-[15px]">MSCB</div>
                    </div>
                    <div class="w-[25%] min-w-[200px] flex flex-row justify-start items-center">
                        <div class="py-[15px]">Họ và tên</div>
                    </div>
                    <div class="w-[20%] min-w-[100px] flex flex-row justify-start items-center">
                        <div class="py-[15px]">Ngày sinh</div>
                    </div>
                    <div class="w-[25%] min-w-[220px] flex flex-row justify-start items-center">
                        <div class="py-[15px]">Đơn vị</div>
                    </div>
                    <div class="w-[10%] min-w-[80px] flex flex-row justify-center items-center">
                        <div class="py-[15px]">@</div>
                    </div>
                </div>
                <!-- end head of table -->            
            
                <!-- body of table -->
                <div id="tbody" 
                x-show="! isLoading"
                class="bg-white max-w-[1000px] rounded-b-lg flex flex-col w-auto justify-start items-start overflow-y-hidden">
                    <template x-for="(item, index) in output" :key="index">
                        <div id="trow" class="hover:bg-gray-100 cursor-default w-full min-w-[750px] flex flex-row bg-white font-[500]">
                            {# index #}
                            <div class="w-[5%] min-w-[50px] flex flex-row justify-start items-center font-[400]">
                                <div x-text="index + 1" class="py-[10px] px-[15px]"></div>
                            </div>
                            {# end index #}

                            {# maso #}
                            <div class="w-[15%] min-w-[100px] flex flex-row justify-start items-center">
                                <div x-text="item.maso" class="py-[10px]"></div>
                            </div>
                            {# end maso #}

                            {# hovaten #}
                            <div class="w-[25%] min-w-[200px] flex flex-row justify-start items-center text-blue">
                                <div @click="$dispatch('portfolio', {target: item.maso})"
                                x-text="item.hovaten" class="py-[10px] hover:underline cursor-pointer"></div>
                            </div>
                            {# end hovaten #}

                            {# ngaysinh #}
                            <div class="w-[20%] min-w-[100px] flex flex-row justify-start items-center font-[400]">
                                <div x-text="item.ngaysinh" class="py-[10px]"></div>
                            </div>
                            {# end ngaysinh #}

                            {# donvi #}
                            <div class="w-[25%] min-w-[220px] flex flex-row justify-start items-center font-[400]">
                                <div class="py-[10px]">Khoa Ngữ văn Tây Ban Nha - Italia</div>
                            </div>
                            {# end donvi #}

                            {# button hoso #}
                            <div class="w-[10%] min-w-[80px] flex flex-row justify-center items-center font-[400]">
                                <div class="hover:bg-green hover:border-transparent rounded-2xl border-2 border-green px-[10px] py-[0px] font-[500] cursor-pointer text-[12px]"
                                >Chọn</div>
                            </div>
                            {# end button hoso #}
                        </div>
                    </template>
                </div>
                <!-- end body of table -->

                {# skeleton #}
                <div x-show="isLoading"
                class="mt-[20px] relative w-full flex flex-col gap-8">
                    <div class="skeleton h-32 w-full"></div>
                    <div class="skeleton h-4 w-28"></div>
                    <div class="skeleton h-4 w-full"></div>
                    <div class="skeleton h-4 w-full"></div>
                </div>
                {# end skeleton #}

            </div>
            {# End Table #}
        </div>
        <!-- end tab 2 -->
        
        <!-- hoso -->
        <div x-data="{open: false, target: ''}" x-show="open" @portfolio.window="target = $event.detail.target; open = true" 
        class="flex justify-center items-start fixed left-0 top-0 h-screen w-screen z-[3001] py-[20px]">
            <div x-show="open" 
            @click="open = false; $dispatch('closepopup');" 
            @keyup.escape.window="open = false; $dispatch('closepopup');" 
            class="fixed left-0 top-0 w-screen h-screen bg-black opacity-70">
            </div>
            <div class="z-[1] gap-4 px-[16px] py-[32px] rounded-xl overflow-hidden w-[800px] h-auto max-h-full bg-white opacity-100 overflow-x-hidden overflow-y-auto">
                <!-- tieu de -->
                <div class="w-full flex flex-col justify-center items-start">
                    <div class="w-full text-[27px] font-[600] leading-tight mb-[20px]">
                        Hồ sơ [QSX9710428]
                    </div>
                    <div class="w-full border my-[15px]"></div>
                </div>
                <!-- end tieu de -->
                <div class="w-full flex flex-col justify-start items-start gap-6">
                    <div class="text-[16px] text-black font-[500]">
                        Thông tin cá nhân
                    </div>
                    <div class="w-full flex flex-row justify-start items-start gap-6">
                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Họ và tên <span class="text-red-600"> *</span>
                            </div>
                            <input type="text" 
                            value="Nguyễn Nhật Nam"
                            class="w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>

                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Ngày sinh <span class="text-red-600"> *</span>
                            </div>
                            <input type="text" 
                            value="20/08/1997"
                            class="w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>
                    </div>
                    <div class="w-full flex flex-row justify-start items-start gap-6">
                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Giới tính <span class="text-red-600"> *</span>
                            </div>
                            <input type="text" 
                            value="Nam"
                            class="w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>

                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Quốc tịch <span class="text-red-600"> *</span>
                            </div>
                            <input type="text" 
                            value="Việt Nam"
                            class="w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>
                    </div>
                    <div class="w-full flex flex-row justify-start items-start gap-6">
                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Nơi sinh
                            </div>
                            <input type="text" 
                            value="Bình Thuận"
                            class="w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>

                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Nguyên quán
                            </div>
                            <input type="text" 
                            value="Quảng Nam"
                            class="w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>
                    </div>
                    <div class="w-full flex flex-row justify-start items-start gap-6">
                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Số CCCD
                            </div>
                            <input type="text" 
                            value="060097007040"
                            class="w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>

                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Ngày cấp CCCD
                            </div>
                            <input type="text" 
                            value="10/12/2020"
                            class="w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>
                    </div>
                    <div class="w-full shrink flex flex-col justify-start items-start gap-2">
                        <div>
                            Nơi cấp CCCD
                        </div>
                        <input type="text" 
                        value="Cục Cảnh sát Quản lý Hành chính về Trật tự Xã hội"
                        class="w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                    </div>
                    <div class="w-full flex flex-row justify-start items-start gap-6">
                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Email
                            </div>
                            <input type="text" 
                            value="nguyennhatnam@hcmussh.edu.vn"
                            class="w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>

                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Số điện thoại
                            </div>
                            <input type="text" 
                            value="0353469292"
                            class="w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>
                    </div>
                    <div class="text-[16px] text-black font-[500]">
                        Thông tin nghề nghiệp
                    </div>
                    <div class="w-full flex flex-row justify-start items-start gap-6">
                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Chức danh nghề nghiệp
                            </div>
                            <input type="text" 
                            value="Chuyên viên"
                            class="w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>

                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Đơn vị công tác
                            </div>
                            <input type="text" 
                            value="Trường Đại học Khoa học Xã hội và Nhân văn"
                            class="w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- end hoso -->



        {# Điều chỉnh #}
        <div class="fixed bottom-[10px] right-[10px] w-[150px] flex flex-row justify-end items-center z-[1]">
            <div x-data 
            @click="$dispatch('modify')"
            class="bg-orange text-white text-[20px] font-[500] px-[15px] py-[15px] rounded-3xl flex justify-center items-center gap-2 cursor-pointer">
                <i class="fa-solid fa-gear"></i>
            </div>
        </div>
        {# End Điều chỉnh #}


        {# download/upload #}
        <div x-data="{open: false}" @modify.window="open = ! open" class="fixed left-0 top-0 z-[2000]">
            <div x-show="open" 
            @click="open = ! open; $dispatch('closepopup'); htmx.trigger('#upload-form', 'htmx:abort')" 
            @keyup.escape.window="open = ! open; $dispatch('closepopup'); htmx.trigger('#upload-form', 'htmx:abort')" 
            class="w-screen h-screen bg-black opacity-70"></div>
            <div x-show="open" class="rounded-xl overflow-hidden fixed top-[50%] translate-y-[-50%] left-[50%] translate-x-[-50%] w-[500px] h-[400px] bg-white opacity-100">
                <div id="form" 
                hx-trigger="modify from:body"
                hx-get="/template/nhansu/form/upload"
                hx-ext="alpine-morph"
                hx-swap="multi:#form:morph"
                class="w-full h-full flex justify-center items-center">
                    <div class="htmx-indicator flex flex-col gap-6 w-[400px]">
                        <div class="skeleton h-32 w-full"></div>
                        <div class="skeleton h-4 w-28"></div>
                        <div class="skeleton h-4 w-full"></div>
                        <div class="skeleton h-4 w-full"></div>
                    </div>
                </div>
            </div>
        </div>
        {# End download/upload #}

    </div>  
</div>