<title id="title">Nhân sự | TCCB - USSH</title>

<div id="boder" class="basis-full shrink overflow-y-hidden overflow-x-hidden flex flex-col justify-start items-center">
    <div id="container" 
    x-data="{
        search: '',
        isLoading: false
    }"
    class="overflow-auto w-full h-full flex flex-col justify-start items-center px-[30px] py-[15px] gap-2">
        <!-- {# Search #} -->
        <div class="w-full flex flex-row justify-center items-center shrink-0">
            <div class="w-[500px] h-[50px] rounded-3xl bg-gray-100 flex flex-row justify-start items-center mb-[20px]">
                <div class="basis-[50px] shrink-0 rounded-full">
                    <i class="fa-solid fa-magnifying-glass text-[14px] text-gray-400"></i>
                </div>
                <input x-model="search"
                @input="$dispatch('searching')"
                class="transition-none bg-gray-100 p-0 rounded-r-3xl basis-[87%] shrink text-[16px] border-transparent focus:border-transparent focus:ring-0" 
                type="search">
            </div>
        </div>
        <!-- {# End search #} -->


        <!-- tabs row-->
        <div id="tabs" 
        x-data="{tab1Active: true, tab2Active: false}"
        class="transition-none z-[1] relative rounded-md w-full max-w-[1000px] flex flex-row justify-start items-start border">
            <div id="tab" 
            :class="tab1Active ? 'border-b-2 border-b-orange font-[500] shadow-md' : 'hover:bg-gray-100'"
            @click="$dispatch('tab1'); tab1Active = true; tab2Active = false"
            class="transition-none p-[10px] cursor-pointer">Nhân sự trong Trường</div>
            <div id="tab2"
            :class="tab2Active ? 'border-b-2 border-b-orange font-[500] shadow-md' : 'hover:bg-gray-100'"
            @click="$dispatch('tab2'); tab1Active = false; tab2Active = true"
            class="transition-none p-[10px] cursor-pointer">Nhân sự ngoài Trường</div>
        </div>
        <!-- end tabs row -->

        <!-- tab 1 -->
        <div x-data="{show:true,
            dataframe: {},
            output: [],
            miniSearch: '',
            async getData() {
                console.log('namprooooo')
                this.miniSearch = new MiniSearch({
                    fields: ['maso','hovaten','ngaysinh'],
                    searchOptions: {
                        prefix: true,
                        combineWith: 'AND',
                    },
                    extractField: (document, fieldName) => {
                        if (fieldName === 'maso') {
                            const nguyen = document['maso']
                            if (nguyen) {
                                return nguyen && nguyen + ' ' + nguyen.slice(6) + ' ' + nguyen.slice(3)
                            }
                        }
                        return fieldName.split('.').reduce((doc, key) => doc && doc[key], document)
                    },
                })
                isLoading = true;
                fetch('/api/nhansu/cohuu/search')            
                    .then((response) => response.json())
                    .then((result) => {
                        result = result.data
                        console.log(result);
                        this.dataframe = result.reduce((byId, song) => {
                            byId[song.id] = song;
                            return byId;
                        }, {});
                        this.output = Object.values(this.dataframe);
                        this.miniSearch.addAll(result);
                        isLoading = false;
                    });
            },
            getSearchResults() {
                if (search === '') {
                    this.output = Object.values(this.dataframe);
                } else {
                    this.output = this.miniSearch.search(search).map(({ id }) => this.dataframe[id])
                }
            },
            updateCohuu(data) {
                console.log(this.dataframe[data.id])
                console.log(data)
                if (this.dataframe[data.id]) {
                    this.miniSearch.remove(this.dataframe[data.id])
                    delete this.dataframe[data.id]
                }
                this.dataframe[data.id] = data
                this.miniSearch.add(this.dataframe[data.id])
                this.getSearchResults()
            }
        }"
        @tab2.window="show = false"
        @tab1.window="show = true"
        x-init="getData()"
        @updatecohuu.window="updateCohuu($event.detail.data)"
        @searching.window="getSearchResults()"
        x-show="show"
        class="w-full max-w-[1000px]">
            {# Table #}
            <div id="table" class="transition-none z-[1] min-w-[750px] shadow-lg relative rounded-lg w-full max-w-[1000px] flex flex-col justify-start text-left">
                <!-- head of table -->
                <div id="thead" 
                class="sticky top-[-15px] w-full min-w-[750px] flex flex-row bg-gray-200 text-black font-[700] rounded-t-lg z-[1]">
                    <div class="w-[5%] min-w-[50px] flex flex-row justify-start items-center">
                        <div class="p-[15px]">#</div>
                    </div>
                    <div class="w-[15%] min-w-[100px] flex flex-row justify-start items-center">
                        <div class="py-[15px]">MSCB</div>
                    </div>
                    <div class="w-[20%] min-w-[200px] flex flex-row justify-start items-center">
                        <div class="py-[15px]">Họ và tên</div>
                    </div>
                    <div class="w-[15%] min-w-[100px] flex flex-row justify-start items-center">
                        <div class="py-[15px]">Ngày sinh</div>
                    </div>
                    <div class="w-[35%] min-w-[220px] flex flex-row justify-start items-center">
                        <div class="py-[15px]">Đơn vị</div>
                    </div>
                    <div class="w-[10%] min-w-[80px] flex flex-row justify-center items-center">
                        <div class="py-[15px]">@</div>
                    </div>
                </div>
                <!-- end head of table -->            
            
                <!-- body of table -->
                <div id="tbody" 
                x-show="! isLoading"
                class="bg-white min-w-[750px] max-w-[1000px] rounded-b-lg flex flex-col w-auto justify-start items-start overflow-y-hidden">
                    <template x-for="(item, index) in output" :key="index">
                        <div id="trow" class="hover:bg-gray-100 cursor-default w-full min-w-[750px] flex flex-row bg-white font-[500]">
                            {# index #}
                            <div class="w-[5%] min-w-[50px] flex flex-row justify-start items-center font-[400]">
                                <div x-text="index + 1" class="py-[10px] px-[15px]"></div>
                            </div>
                            {# end index #}

                            {# maso #}
                            <div class="w-[15%] min-w-[100px] flex flex-row justify-start items-center">
                                <div x-text="item.maso" class="py-[10px]"></div>
                            </div>
                            {# end maso #}

                            {# hovaten #}
                            <div class="w-[20%] min-w-[200px] flex flex-row justify-start items-center text-blue">
                                <div @click="$dispatch('portfolio', {target: item.maso, type: 'cohuu'})"
                                x-text="item.hovaten" class="py-[10px] hover:underline cursor-pointer"></div>
                            </div>
                            {# end hovaten #}

                            {# ngaysinh #}
                            <div class="w-[15%] min-w-[100px] flex flex-row justify-start items-center font-[400]">
                                <div x-text="item.ngaysinh" class="py-[10px]"></div>
                            </div>
                            {# end ngaysinh #}

                            {# donvi #}
                            <div class="w-[35%] min-w-[220px] flex flex-row justify-start items-center font-[400]">
                                <div x-text="item.donvicongtac" class="py-[10px]"></div>
                            </div>
                            {# end donvi #}

                            {# button hoso #}
                            <div class="w-[10%] min-w-[80px] flex flex-row justify-center items-center font-[400]">
                                <div class="hover:bg-green hover:border-transparent rounded-2xl border-2 border-green px-[10px] py-[0px] font-[500] cursor-pointer text-[12px]"
                                @click="$dispatch('runlayso', {giangvien: item})">Lấy số HĐ</div>
                            </div>
                            {# end button hoso #}
                        </div>
                    </template>
                </div>
                <!-- end body of table -->

                {# skeleton #}
                <div x-show="isLoading"
                class="mt-[20px] relative min-w-[750px] w-full flex flex-col gap-8">
                    <div class="skeleton h-32 w-full"></div>
                    <div class="skeleton h-4 w-28"></div>
                    <div class="skeleton h-4 w-full"></div>
                    <div class="skeleton h-4 w-full"></div>
                </div>
                {# end skeleton #}

            </div>
            {# End Table #}
        </div>
        <!-- end tab 1 -->

        
        <!-- tab 2 -->
        <div x-data="{show:false,
            dataframe: {},
            output: [],
            miniSearch: '',
            async getData() {
                console.log('namprooooo')
                this.miniSearch = new MiniSearch({
                    fields: ['maso','hovaten','ngaysinh'],
                    searchOptions: {
                        prefix: true,
                        combineWith: 'AND',
                    },
                    extractField: (document, fieldName) => {
                        if (fieldName === 'maso') {
                            const nguyen = document['maso']
                            if (nguyen) {
                                return nguyen && nguyen + ' ' + nguyen.slice(6) + ' ' + nguyen.slice(3)
                            }
                        }
                        return fieldName.split('.').reduce((doc, key) => doc && doc[key], document)
                    },
                })
                isLoading = true;
                fetch('/api/nhansu/thinhgiang/search')            
                    .then((response) => response.json())
                    .then((result) => {
                        result = result.data
                        console.log(result);
                        this.dataframe = result.reduce((byId, song) => {
                            byId[song.id] = song;
                            return byId;
                        }, {});
                        this.output = Object.values(this.dataframe);
                        this.miniSearch.addAll(result);
                        isLoading = false;
                    });
            },
            getSearchResults() {
                if (search === '') {
                    this.output = Object.values(this.dataframe);
                } else {
                    this.output = this.miniSearch.search(search).map(({ id }) => this.dataframe[id])
                }
            },
            updateThinhgiang(data) {
                console.log(this.dataframe[data.id])
                console.log(data)
                if (this.dataframe[data.id]) {
                    this.miniSearch.remove(this.dataframe[data.id])
                    delete this.dataframe[data.id]
                }
                this.dataframe[data.id] = data
                this.miniSearch.add(this.dataframe[data.id])
                this.getSearchResults()
            }
        }"
        @tab2.window="show = true"
        @tab1.window="show = false"
        x-init="console.log('laplai');getData()"
        @updatethinhgiang.window="updateThinhgiang($event.detail.data)"
        @searching.window="getSearchResults()"
        x-show="show"
        class="w-full max-w-[1000px]">
            {# Table #}
            <div id="table" class="transition-none z-[1] min-w-[750px] shadow-lg relative rounded-lg w-full max-w-[1000px] flex flex-col justify-start text-left">
                <!-- head of table -->
                <div id="thead" 
                class="sticky top-[-15px] w-full min-w-[750px] flex flex-row bg-gray-200 text-black font-[700] rounded-t-lg z-[1]">
                    <div class="w-[5%] min-w-[50px] flex flex-row justify-start items-center">
                        <div class="p-[15px]">#</div>
                    </div>
                    <div class="w-[15%] min-w-[100px] flex flex-row justify-start items-center">
                        <div class="py-[15px]">MSCB</div>
                    </div>
                    <div class="w-[20%] min-w-[200px] flex flex-row justify-start items-center">
                        <div class="py-[15px]">Họ và tên</div>
                    </div>
                    <div class="w-[15%] min-w-[100px] flex flex-row justify-start items-center">
                        <div class="py-[15px]">Ngày sinh</div>
                    </div>
                    <div class="w-[35%] min-w-[220px] flex flex-row justify-start items-center">
                        <div class="py-[15px]">Đơn vị công tác</div>
                    </div>
                    <div class="w-[10%] min-w-[80px] flex flex-row justify-center items-center">
                        <div class="py-[15px]">@</div>
                    </div>
                </div>
                <!-- end head of table -->            
            
                <!-- body of table -->
                <div id="tbody" 
                x-show="! isLoading"
                class="bg-white min-w-[750px] max-w-[1000px] rounded-b-lg flex flex-col w-auto justify-start items-start overflow-y-hidden">
                    <template x-for="(item, index) in output" :key="index">
                        <div id="trow" class="hover:bg-gray-100 cursor-default w-full min-w-[750px] flex flex-row bg-white font-[500]">
                            {# index #}
                            <div class="w-[5%] min-w-[50px] flex flex-row justify-start items-center font-[400]">
                                <div x-text="index + 1" class="py-[10px] px-[15px]"></div>
                            </div>
                            {# end index #}

                            {# maso #}
                            <div class="w-[15%] min-w-[100px] flex flex-row justify-start items-center">
                                <div x-text="item.maso" class="py-[10px]"></div>
                            </div>
                            {# end maso #}

                            {# hovaten #}
                            <div class="w-[20%] min-w-[200px] flex flex-row justify-start items-center text-blue">
                                <div @click="$dispatch('portfolio', {target: item.maso, type: 'thinhgiang'})"
                                x-text="item.hovaten" class="py-[10px] hover:underline cursor-pointer"></div>
                            </div>
                            {# end hovaten #}

                            {# ngaysinh #}
                            <div class="w-[15%] min-w-[100px] flex flex-row justify-start items-center font-[400]">
                                <div x-text="item.ngaysinh" class="py-[10px]"></div>
                            </div>
                            {# end ngaysinh #}

                            {# donvi #}
                            <div class="w-[35%] min-w-[220px] flex flex-row justify-start items-center font-[400]">
                                <div x-text="item.donvicongtac" class="py-[10px]"></div>
                            </div>
                            {# end donvi #}

                            {# button hoso #}
                            <div class="w-[10%] min-w-[80px] flex flex-row justify-center items-center font-[400]">
                                <div class="hover:bg-green hover:border-transparent rounded-2xl border-2 border-green px-[10px] py-[0px] font-[500] cursor-pointer text-[12px]"
                                @click="$dispatch('runlayso', {giangvien: item})">Lấy số HĐ</div>
                            </div>
                            {# end button hoso #}
                        </div>
                    </template>
                </div>
                <!-- end body of table -->

                {# skeleton #}
                <div x-show="isLoading"
                class="mt-[20px] relative min-w-[750px] w-full flex flex-col gap-8">
                    <div class="skeleton h-32 w-full"></div>
                    <div class="skeleton h-4 w-28"></div>
                    <div class="skeleton h-4 w-full"></div>
                    <div class="skeleton h-4 w-full"></div>
                </div>
                {# end skeleton #}

            </div>
            {# End Table #}
        </div>
        <!-- end tab 2 -->
        
        <!-- hoso -->
        <div x-data="{open: false, target: '', type: '', thinhgiang: {}, button_text: 'Cập nhật'}" x-show="open" 
        @portfolio.window="target = $event.detail.target; type = $event.detail.type;
        console.log(type)
        button_text = 'Cập nhật'
        fetch(`/api/nhansu/read/${target}`)
        .then((response) => response.json())
        .then((result) => {
            thinhgiang = result;
            open = true
        });"
        @newportfolio.window="
        type = $event.detail.type;
        console.log(type)
        open = true,
        button_text = 'Thêm mới'
        target='NEW';
        thinhgiang = (type === 'cohuu') ? {co_llkh: true, co_bang: true, co_nvsp: true} : {co_llkh: false, co_bang: false, co_nvsp: false}"
        class="flex justify-center items-start fixed left-0 top-0 h-screen w-screen z-[3001] py-[20px] overflow-auto">
            <div x-show="open" 
            @click="open = false; $dispatch('closepopup');" 
            @keyup.escape.window="open = false; $dispatch('closepopup');" 
            class="fixed left-0 top-0 w-screen h-screen bg-black opacity-70">
            </div>
            <div class="z-[1] gap-4 px-[16px] py-[32px] rounded-xl overflow-hidden w-[800px] h-auto bg-white opacity-100">
                <!-- tieu de -->
                <div class="w-full flex flex-col justify-center items-start">
                    <div class="w-full text-[27px] font-[600] leading-tight mb-[20px]">
                        Hồ sơ [<span x-text="target"></span>]
                    </div>
                    <div class="w-full border my-[15px]"></div>
                </div>
                <!-- end tieu de -->

                <!-- noi dung -->
                <div class="w-full flex flex-col justify-start items-start gap-6">
                    <div class="text-[16px] text-black font-[500] mt-[10px]">
                        Thông tin cá nhân
                    </div>
                    <div class="w-full flex flex-row justify-start items-start gap-6">
                        <!-- start họ và tên -->
                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Họ và tên <span class="text-red-600"> *</span>
                            </div>
                            <input type="search" 
                            x-model="thinhgiang.hovaten"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>
                        <!-- end họ và tên -->

                        <!-- start ngày sinh -->
                        <div class="basis-[24%] shrink flex flex-col justify-start items-start gap-2">
                            
                            <div>
                                Ngày sinh <span class="text-red-600"> *</span>
                            </div>
                            <input x-data="{
                                checkStrDate(str) {
                                    if (str) {
                                        const result = [...str].every(
                                            char => (char >= '0' && char <= '9') || (char == '/')
                                        );
                                        return result;
                                    } else {
                                        return false
                                    }
                                },
                                converDay() {
                                    if (this.checkStrDate(thinhgiang.ngaysinh)) {
                                        list = thinhgiang.ngaysinh.split('/');
                                        d = Number(list[0])
                                        m = Number(list[1])
                                        y = Number(list[2])
                                        if (list.length !== 3 || 
                                            list[0].length > 2 || 
                                            list[1].length > 2 || 
                                            list[2].length > 4 || 
                                            list[2].length == 3 ||
                                            d > 31 ||
                                            m > 12 ||
                                            y > 2099) {
                                            thinhgiang.ngaysinh = ''
                                        } else {
                                            today = new Date();
                                            currentYear = today.getFullYear();

                                            if (list[2].length == 2) {
                                                if (y > (currentYear - 2000)) {
                                                    year_num = y + 1900
                                                } else {
                                                    year_num = y + 2000
                                                }
                                            } else {
                                                year_num = y
                                            }
                                            if ((m == 2 && d > 29) || ([1,3,5,7,8,10,12].includes(m) && d > 31) || ([2,4,6,9,11].includes(m) && d > 30)) {
                                                thinhgiang.ngaysinh = ''
                                            } else {
                                                day = d.toString().padStart(2,'0')
                                                if ([1,2].includes(m)) {
                                                    month = m.toString().padStart(2,'0')
                                                } else {
                                                    month = m.toString()
                                                }
                                                year = year_num.toString()
                                                thinhgiang.ngaysinh = `${day}/${month}/${year}`
                                            }
                                        }
                                    } else {
                                        thinhgiang.ngaysinh = ''
                                    }
 
                                }
                            }"
                            type="search"
                            @focusout="converDay()"
                            @keyup.enter="converDay()"
                            x-model="thinhgiang.ngaysinh"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>
                        <!-- end ngày sinh -->

                        <!-- start giới tính -->
                        <div x-data="{
                            showoptions: false,
                            output: [],
                            dataframe: [],
                            research: '',
                            backspace: true,
                            choose: 0,
                            miniSearch: '',
                            async getData() {
                                this.miniSearch = new MiniSearch({
                                    fields: ['value'],
                                    searchOptions: {
                                        prefix: true,
                                        combineWith: 'AND',
                                    }
                                })
                                fetch('/api/danhmuc/gioitinh')            
                                .then((response) => response.json())
                                .then((result) => {
                                    this.dataframe = result.reduce((byId, song) => {
                                        byId[song.id] = song;
                                        return byId;
                                    }, {});
                                    this.output = Object.values(this.dataframe);
                                    this.miniSearch.addAll(result);
                                });
                            },
                            filteredItems() {
                                this.showoptions = true;
                                if (thinhgiang.gioitinh) {
                                    this.output = this.miniSearch.search(thinhgiang.gioitinh).map(({ id }) => this.dataframe[id])
                                } else {
                                    this.output = Object.values(this.dataframe);
                                }
                            },
                            addItem(item) {
                                thinhgiang.gioitinh = item.value;
                                this.showoptions = false;
                            },
                            checkItem() {
                                this.filteredItems()
                                if (this.output.length >= 1) {
                                    if (thinhgiang.gioitinh != this.output[0].value) {
                                        thinhgiang.gioitinh = ''
                                    }
                                } else {
                                    thinhgiang.gioitinh = ''
                                }
                            },
                            enterEvent() {
                                if (this.output) {
                                    this.addItem(this.output[this.choose])
                                } else {
                                    thinhgiang.gioitinh = ''
                                }
                            },
                            eventBackspace() {
                                this.backspace = true;
                            },
                            showoptionscheck(e) {
                                if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                    this.choose = 0;
                                }
                            },
                            focusinputcheck() {
                                this.filteredItems();
                                this.showoptions = true;
                            },
                            checkchoose(index) {
                                return index === this.choose
                            },
                            selectoption(type) {
                                if (type === 'up' && this.choose > 0) {
                                    this.choose = this.choose - 1
                                    item = document.getElementById('gioitinh'+this.choose).getBoundingClientRect()
                                    frame = $refs.gioitinh.getBoundingClientRect()
                                    if ((item.bottom - frame.top) < item.height) {
                                        $refs.gioitinh.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                    }
                                } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                    this.choose = this.choose + 1
                                    item = document.getElementById('gioitinh'+this.choose).getBoundingClientRect()
                                    frame = $refs.gioitinh.getBoundingClientRect()
                                    if ((frame.bottom - item.top) < item.height) {
                                        $refs.gioitinh.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                    }
                                }
                            }
                        }" x-init="getData()"
                        class="basis-[23%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Giới tính <span class="text-red-600"> *</span>
                            </div>
                            <input type="search"
                            @focusout.debounce.100ms="checkItem();showoptions = false;"
                            @keyup.enter="enterEvent()"
                            @keydown.up.prevent.throttle.100ms="selectoption('up')"
                            @keydown.down.prevent.throttle.100ms="selectoption('down')"
                            @keyup.up.prevent
                            @keyup.down.prevent
                            x-ref="input"
                            @focus="focusinputcheck()"
                            @keyup = 'showoptionscheck'
                            @keyup.backspace="eventBackspace"
                            x-model="thinhgiang.gioitinh"
                            @input="filteredItems()"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">

                            <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                <ul x-ref="gioitinh" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[175px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                    <template x-if="output.length === 0">
                                        <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                    </template>
                                    <template x-for="(item, index) in output" :key="item.id">
                                        <li x-text="item.value"
                                        :id="'gioitinh'+index"
                                        @click="addItem(item)"
                                        @mouseover="choose = index"
                                        :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                        class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                    </template>
                                </ul>
                            </div>
                        
                        </div>
                        <!-- end giới tính -->
                    </div>
                    <div class="w-full flex flex-row justify-start items-start gap-6">
                        <!-- start quốc tịch -->
                        <div x-data="{
                            showoptions: false,
                            output: [],
                            dataframe: [],
                            research: '',
                            backspace: true,
                            choose: 0,
                            miniSearch: '',
                            async getData() {
                                this.miniSearch = new MiniSearch({
                                    fields: ['value'],
                                    searchOptions: {
                                        prefix: true,
                                        combineWith: 'AND',
                                    }
                                })
                                fetch('/api/danhmuc/quocgia')            
                                .then((response) => response.json())
                                .then((result) => {
                                    this.dataframe = result.reduce((byId, song) => {
                                        byId[song.id] = song;
                                        return byId;
                                    }, {});
                                    this.output = Object.values(this.dataframe);
                                    this.miniSearch.addAll(result);
                                });
                            },
                            filteredItems() {
                                this.showoptions = true;
                                if (thinhgiang.quoctich) {
                                    this.output = this.miniSearch.search(thinhgiang.quoctich).map(({ id }) => this.dataframe[id])
                                } else {
                                    this.output = Object.values(this.dataframe);
                                }
                            },
                            addItem(item) {
                                thinhgiang.quoctich = item.value;
                                this.showoptions = false;
                            },
                            checkItem() {
                                this.filteredItems()
                                if (this.output.length >= 1) {
                                    if (thinhgiang.quoctich != this.output[0].value) {
                                        thinhgiang.quoctich = ''
                                    }
                                } else {
                                    thinhgiang.quoctich = ''
                                }
                            },
                            enterEvent() {
                                if (this.output) {
                                    this.addItem(this.output[this.choose])
                                } else {
                                    thinhgiang.quoctich = ''
                                }
                            },
                            eventBackspace() {
                                this.backspace = true;
                            },
                            showoptionscheck(e) {
                                if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                    this.choose = 0;
                                }
                            },
                            focusinputcheck() {
                                this.filteredItems();
                                this.showoptions = true;
                            },
                            checkchoose(index) {
                                return index === this.choose
                            },
                            selectoption(type) {
                                if (type === 'up' && this.choose > 0) {
                                    this.choose = this.choose - 1
                                    item = document.getElementById('quoctich'+this.choose).getBoundingClientRect()
                                    frame = $refs.quoctich.getBoundingClientRect()
                                    if ((item.bottom - frame.top) < item.height) {
                                        $refs.quoctich.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                    }
                                } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                    this.choose = this.choose + 1
                                    item = document.getElementById('quoctich'+this.choose).getBoundingClientRect()
                                    frame = $refs.quoctich.getBoundingClientRect()
                                    if ((frame.bottom - item.top) < item.height) {
                                        $refs.quoctich.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                    }
                                }
                            }
                        }" x-init="getData()"
                        class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Quốc tịch
                            </div>
                            <input type="search"
                            @focusout.debounce.100ms="checkItem();showoptions = false;"
                            @keyup.enter="enterEvent()"
                            @keydown.up.prevent.throttle.100ms="selectoption('up')"
                            @keydown.down.prevent.throttle.100ms="selectoption('down')"
                            @keyup.up.prevent
                            @keyup.down.prevent
                            x-ref="input"
                            @focus="focusinputcheck()"
                            @keyup = 'showoptionscheck'
                            @keyup.backspace="eventBackspace"
                            x-model="thinhgiang.quoctich"
                            @input="filteredItems()"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">

                            <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                <ul x-ref="quoctich" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[375px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                    <template x-if="output.length === 0">
                                        <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                    </template>
                                    <template x-for="(item, index) in output" :key="item.id">
                                        <li x-text="item.value"
                                        :id="'quoctich'+index"
                                        @click="addItem(item)"
                                        @mouseover="choose = index"
                                        :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                        class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                    </template>
                                </ul>
                            </div>
                        
                        </div>
                        <!-- end quốc tịch -->

                        <!-- start mã số cán bộ -->
                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                MSCB <span class="text-red-600"> *</span>
                            </div>
                            <input type="search" 
                            x-model="thinhgiang.maso"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>
                        <!-- end mã số cán bộ -->
                    </div>


                    <div class="w-full flex flex-row justify-start items-start gap-6">
                        <div class="basis-[24%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Số CCCD/Hộ chiếu
                            </div>
                            <input type="search" 
                            x-model="thinhgiang.CCCD_so"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>

                        <div x-data="{get checkcccd() {
                            if (thinhgiang.CCCD_so) {
                                return false
                            } else {
                                thinhgiang.CCCD_ngay = ''
                                return true
                            }
                        }}"
                        class="basis-[23%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Ngày cấp
                            </div>
                            <input :disabled="checkcccd"
                            :class="checkcccd ? 'cursor-not-allowed' : ''"
                            x-data="{
                                checkStrDate(str) {
                                    if (str) {
                                        const result = [...str].every(
                                            char => (char >= '0' && char <= '9') || (char == '/')
                                        );
                                        return result;
                                    } else {
                                        return false
                                    }
                                },
                                converDay() {
                                    if (this.checkStrDate(thinhgiang.CCCD_ngay)) {
                                        list = thinhgiang.CCCD_ngay.split('/');
                                        d = Number(list[0])
                                        m = Number(list[1])
                                        y = Number(list[2])
                                        if (list.length !== 3 || 
                                            list[0].length > 2 || 
                                            list[1].length > 2 || 
                                            list[2].length > 4 || 
                                            list[2].length == 3 ||
                                            d > 31 ||
                                            m > 12 ||
                                            y > 2999) {
                                            thinhgiang.CCCD_ngay = ''
                                        } else {
                                            today = new Date();
                                            currentYear = today.getFullYear();

                                            if (list[2].length == 2) {
                                                if (y > (currentYear - 2000)) {
                                                    year_num = y + 1900
                                                } else {
                                                    year_num = y + 2000
                                                }
                                            } else {
                                                year_num = y
                                            }
                                            if ((m == 2 && d > 29) || ([1,3,5,7,8,10,12].includes(m) && d > 31) || ([2,4,6,9,11].includes(m) && d > 30)) {
                                                thinhgiang.CCCD_ngay = ''
                                            } else {
                                                day = d.toString().padStart(2,'0')
                                                if ([1,2].includes(m)) {
                                                    month = m.toString().padStart(2,'0')
                                                } else {
                                                    month = m.toString()
                                                }
                                                year = year_num.toString()
                                                thinhgiang.CCCD_ngay = `${day}/${month}/${year}`
                                            }
                                        }
                                    } else {
                                        thinhgiang.CCCD_ngay = ''
                                    }
 
                                }
                            }"
                            type="search"
                            @focusout="converDay()"
                            @keyup.enter="converDay()"
                            x-model="thinhgiang.CCCD_ngay"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>

                        <div x-data="{
                            cccd_noi: '',
                            checkcccd() {
                            if (thinhgiang.CCCD_so) {
                                this.cccd_noi = 'Cục Cảnh sát Quản lý Hành chính về Trật tự Xã hội'
                            } else {
                                this.cccd_noi = ''
                            }
                            console.log(this.cccd_noi)
                            return true
                        }}"
                        class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Nơi cấp
                            </div>
                            <input type="search"
                            :disabled="checkcccd"
                            x-model="cccd_noi"
                            class="cursor-not-allowed w-full h-[45px] text-[15px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>
                    </div>
                    <div class="w-full flex flex-row justify-start items-start gap-6">
                        <div x-data="{
                            checkemail () {
                                if ((thinhgiang.email) && (thinhgiang.email.includes('@hcmussh.edu.vn'))) {
                                    return true
                                } else {
                                    thinhgiang.email += '@hcmussh.edu.vn'
                                }
                            }
                        }"
                        class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Email
                            </div>
                            <input type="search" 
                            x-model="thinhgiang.email"
                            @focusout="checkemail()"
                            @keyup.enter="checkemail()"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>

                        <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Số điện thoại
                            </div>
                            <input type="search" 
                            x-model="thinhgiang.sdt"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                        </div>
                    </div>
                    <div class="text-[16px] text-black font-[500] mt-[10px]">
                        Trình độ học vấn
                    </div>
                    <div class="w-full flex flex-row justify-start items-start gap-6">

                        <!-- học vị -->
                        <div x-data="{
                            showoptions: false,
                            output: [],
                            dataframe: [],
                            research: '',
                            backspace: true,
                            choose: 0,
                            miniSearch: '',
                            getData() {
                                this.miniSearch = new MiniSearch({
                                    fields: ['value'],
                                    searchOptions: {
                                        prefix: true,
                                        combineWith: 'AND',
                                    }
                                })
                                fetch('/api/danhmuc/hocvi')            
                                .then((response) => response.json())
                                .then((result) => {
                                    this.dataframe = result.reduce((byId, song) => {
                                        byId[song.id] = song;
                                        return byId;
                                    }, {});
                                    this.output = Object.values(this.dataframe);
                                    this.miniSearch.addAll(result);
                                });
                            },
                            filteredItems() {
                                this.showoptions = true;
                                if (thinhgiang.hocvi) {
                                    this.output = this.miniSearch.search(thinhgiang.hocvi).map(({ id }) => this.dataframe[id])
                                } else {
                                    this.output = Object.values(this.dataframe);
                                }
                            },
                            addItem(item) {
                                thinhgiang.hocvi = item.value;
                                this.showoptions = false;
                                $dispatch('hocvi');
                            },
                            checkItem() {
                                this.filteredItems()
                                if (this.output.length >= 1) {
                                    if (thinhgiang.hocvi != this.output[0].value) {
                                        thinhgiang.hocvi = ''
                                    }
                                } else {
                                    thinhgiang.hocvi = ''
                                }
                            },
                            enterEvent() {
                                if (this.output) {
                                    this.addItem(this.output[this.choose])
                                } else {
                                    thinhgiang.hocvi = ''
                                }
                            },
                            eventBackspace() {
                                this.backspace = true;
                            },
                            showoptionscheck(e) {
                                if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                    this.choose = 0;
                                }
                            },
                            focusinputcheck() {
                                this.filteredItems();
                                this.showoptions = true;
                            },
                            checkchoose(index) {
                                return index === this.choose
                            },
                            selectoption(type) {
                                if (type === 'up' && this.choose > 0) {
                                    this.choose = this.choose - 1
                                    item = document.getElementById('hocvi'+this.choose).getBoundingClientRect()
                                    frame = $refs.hocvi.getBoundingClientRect()
                                    if ((item.bottom - frame.top) < item.height) {
                                        $refs.hocvi.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                    }
                                } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                    this.choose = this.choose + 1
                                    item = document.getElementById('hocvi'+this.choose).getBoundingClientRect()
                                    frame = $refs.hocvi.getBoundingClientRect()
                                    if ((frame.bottom - item.top) < item.height) {
                                        $refs.hocvi.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                    }
                                }
                            }
                        }" x-init="getData()"
                        class="basis-[25%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Học vị
                            </div>
                            <input type="search"
                            @focusout.debounce.100ms="checkItem();showoptions = false;"
                            @keyup.enter="enterEvent()"
                            @keydown.up.prevent.throttle.100ms="selectoption('up')"
                            @keydown.down.prevent.throttle.100ms="selectoption('down')"
                            @keyup.up.prevent
                            @keyup.down.prevent
                            x-ref="input"
                            @focus="focusinputcheck()"
                            @keyup = 'showoptionscheck'
                            @keyup.backspace="eventBackspace"
                            x-model="thinhgiang.hocvi"
                            @input="filteredItems()"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">

                            <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                <ul x-ref="hocvi" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[200px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                    <template x-if="output.length === 0">
                                        <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                    </template>
                                    <template x-for="(item, index) in output" :key="item.id">
                                        <li x-text="item.value"
                                        :id="'hocvi'+index"
                                        @click="addItem(item)"
                                        @mouseover="choose = index"
                                        :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                        class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                    </template>
                                </ul>
                            </div>
                        
                        </div>
                        <!-- end học vị -->

                        <!-- chuyên ngành -->
                        <div x-data="{
                            showoptions: false,
                            output: [],
                            dataframe: [],
                            research: '',
                            backspace: true,
                            choose: 0,
                            miniSearch: '',
                            async updateData() {
                                thinhgiang.hocvi_nganh = ''
                                switch (thinhgiang.hocvi) {
                                    case 'Cử nhân':
                                        url = '/api/danhmuc/nganh-daihoc';
                                        break;
                                    case 'Thạc sĩ':
                                        url = '/api/danhmuc/nganh-thacsi';
                                        break;
                                    case 'Tiến sĩ':
                                        url = '/api/danhmuc/nganh-tiensi';
                                        break;
                                    case 'Tiến sĩ khoa học':
                                        url = '/api/danhmuc/nganh-tiensi';
                                        break;
                                    default:
                                        url = '/api/danhmuc/nganh-thacsi';
                                }
                                fetch(url)            
                                .then((response) => response.json())
                                .then((result) => {
                                    this.dataframe = result.reduce((byId, song) => {
                                        byId[song.id] = song;
                                        return byId;
                                    }, {});
                                    this.output = Object.values(this.dataframe);
                                    this.miniSearch.removeAll();
                                    this.miniSearch.addAll(result);
                                });
                            },
                            getData() {
                                this.miniSearch = new MiniSearch({
                                    fields: ['value'],
                                    searchOptions: {
                                        prefix: true,
                                        combineWith: 'AND'
                                    }
                                })
                                this.updateData()
                            },
                            filteredItems() {
                                this.showoptions = true;
                                if (thinhgiang.hocvi_nganh) {
                                    this.output = this.miniSearch.search(thinhgiang.hocvi_nganh).map(({ id }) => this.dataframe[id])
                                } else {
                                    this.output = Object.values(this.dataframe);
                                }
                            },
                            addItem(item) {
                                thinhgiang.hocvi_nganh = item.value;
                                this.showoptions = false;
                            },
                            checkItem() {
                                this.filteredItems()
                                if (this.output.length >= 1) {
                                    if (thinhgiang.hocvi_nganh != this.output[0].value) {
                                        thinhgiang.hocvi_nganh = ''
                                    }
                                } else {
                                    thinhgiang.hocvi_nganh = ''
                                }
                            },
                            enterEvent() {
                                if (this.output) {
                                    this.addItem(this.output[this.choose])
                                } else {
                                    thinhgiang.hocvi_nganh = ''
                                }
                            },
                            eventBackspace() {
                                this.backspace = true;
                            },
                            showoptionscheck(e) {
                                if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                    this.choose = 0;
                                }
                            },
                            focusinputcheck() {
                                this.filteredItems();
                                this.showoptions = true;
                            },
                            checkchoose(index) {
                                return index === this.choose
                            },
                            selectoption(type) {
                                if (type === 'up' && this.choose > 0) {
                                    this.choose = this.choose - 1
                                    item = document.getElementById('hocvi_nganh'+this.choose).getBoundingClientRect()
                                    frame = $refs.hocvi_nganh.getBoundingClientRect()
                                    if ((item.bottom - frame.top) < item.height) {
                                        $refs.hocvi_nganh.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                    }
                                } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                    this.choose = this.choose + 1
                                    item = document.getElementById('hocvi_nganh'+this.choose).getBoundingClientRect()
                                    frame = $refs.hocvi_nganh.getBoundingClientRect()
                                    if ((frame.bottom - item.top) < item.height) {
                                        $refs.hocvi_nganh.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                    }
                                }
                            },
                            get checkhocvi() {
                                if (thinhgiang.hocvi) {
                                    return false
                                } else {
                                    thinhgiang.hocvi_nganh = ''
                                    return true
                                }
                            }
                        }" x-init="getData()" 
                        class="basis-[75%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Chuyên ngành
                            </div>
                            <input type="search"
                            :disabled="checkhocvi"
                            :class="checkhocvi ? 'cursor-not-allowed' : ''"
                            @focusout.debounce.100ms="checkItem();showoptions = false;"
                            @keyup.enter="enterEvent()"
                            @keydown.up.prevent.throttle.100ms="selectoption('up')"
                            @keydown.down.prevent.throttle.100ms="selectoption('down')"
                            @keyup.up.prevent
                            @keyup.down.prevent
                            x-ref="input"
                            @focus="updateData(); focusinputcheck();"
                            @keyup = 'showoptionscheck'
                            @keyup.backspace="eventBackspace"
                            x-model="thinhgiang.hocvi_nganh"
                            @input="filteredItems()"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">

                            <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                <ul x-ref="hocvi_nganh" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[560px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                    <template x-if="output.length === 0">
                                        <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                    </template>
                                    <template x-for="(item, index) in output" :key="item.id">
                                        <li x-text="item.value"
                                        :id="'hocvi_nganh'+index"
                                        @click="addItem(item)"
                                        @mouseover="choose = index"
                                        :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                        class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                    </template>
                                </ul>
                            </div>
                        
                        </div>
                        <!-- end chuyên ngành -->
                    </div>
                    <div class="w-full flex flex-row justify-start items-start gap-6">


                        <!-- học hàm -->
                        <div x-data="{
                            showoptions: false,
                            output: [],
                            items: [{id:1,value:'Phó giáo sư'},{id:2,value:'Giáo sư'}],
                            dataframe: [],
                            research: '',
                            backspace: true,
                            choose: 0,
                            miniSearch: '',
                            getData() {
                                this.miniSearch = new MiniSearch({
                                    fields: ['value'],
                                    searchOptions: {
                                        prefix: true,
                                        combineWith: 'AND',
                                    }
                                })
                                fetch('/api/danhmuc/hocham')            
                                .then((response) => response.json())
                                .then((result) => {
                                    this.dataframe = result.reduce((byId, song) => {
                                        byId[song.id] = song;
                                        return byId;
                                    }, {});
                                    this.output = Object.values(this.dataframe);
                                    this.miniSearch.addAll(result);
                                });
                            },
                            filteredItems() {
                                this.showoptions = true;
                                if (thinhgiang.hocham) {
                                    this.output = this.miniSearch.search(thinhgiang.hocham).map(({ id }) => this.dataframe[id])
                                } else {
                                    this.output = Object.values(this.dataframe);
                                }
                            },
                            addItem(item) {
                                thinhgiang.hocham = item.value;
                                this.showoptions = false;
                            },
                            checkItem() {
                                this.filteredItems();
                                if (this.output.length >= 1) {
                                    if (thinhgiang.hocham != this.output[0].value) {
                                        thinhgiang.hocham = ''
                                    }
                                } else {
                                    thinhgiang.hocham = ''
                                }
                                this.showoptions = false;
                                
                            },
                            enterEvent() {
                                if (this.output) {
                                    this.addItem(this.output[this.choose])
                                } else {
                                    thinhgiang.hocham = ''
                                }
                            },
                            eventBackspace() {
                                this.backspace = true;
                            },
                            showoptionscheck(e) {
                                if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                    this.choose = 0;
                                }
                            },
                            focusinputcheck() {
                                this.filteredItems();
                                this.showoptions = true;
                            },
                            checkchoose(index) {
                                return index === this.choose
                            },
                            selectoption(type) {
                                if (type === 'up' && this.choose > 0) {
                                    this.choose = this.choose - 1
                                    item = document.getElementById('hocham'+this.choose).getBoundingClientRect()
                                    frame = $refs.hocham.getBoundingClientRect()
                                    if ((item.bottom - frame.top) < item.height) {
                                        $refs.hocham.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                    }
                                } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                    this.choose = this.choose + 1
                                    item = document.getElementById('hocham'+this.choose).getBoundingClientRect()
                                    frame = $refs.hocham.getBoundingClientRect()
                                    if ((frame.bottom - item.top) < item.height) {
                                        $refs.hocham.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                    }
                                }
                            },
                            get checkhocvi() {
                                if ((thinhgiang.hocvi) && (thinhgiang.hocvi.includes('Tiến sĩ'))) {
                                    return false
                                } else {
                                    thinhgiang.hocham = ''
                                    return true
                                }
                            }
                        }" x-init="getData()"
                        class="basis-[25%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Học hàm
                            </div>
                            <input type="search"
                            :disabled="checkhocvi"
                            :class="checkhocvi ? 'cursor-not-allowed' : ''"
                            @focusout.debounce.100ms="checkItem()"
                            @keyup.enter="enterEvent()"
                            @keydown.up.prevent.throttle.100ms="selectoption('up')"
                            @keydown.down.prevent.throttle.100ms="selectoption('down')"
                            @keyup.up.prevent
                            @keyup.down.prevent
                            x-ref="input"
                            @focus="focusinputcheck()"
                            @keyup = 'showoptionscheck'
                            @keyup.backspace="eventBackspace"
                            x-model="thinhgiang.hocham"
                            @input="filteredItems()"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">

                            <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                <ul x-ref="hocham" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[200px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                    <template x-if="output.length === 0">
                                        <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                    </template>
                                    <template x-for="(item, index) in output" :key="item.id">
                                        <li x-text="item.value"
                                        :id="'hocham'+index"
                                        @click="addItem(item)"
                                        @mouseover="choose = index"
                                        :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                        class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                    </template>
                                </ul>
                            </div>
                        </div>
                        <!-- end học hàm -->


                        <!-- chuyên ngành học hàm -->
                        <div x-data="{
                            showoptions: false,
                            output: [],
                            dataframe: [],
                            research: '',
                            backspace: true,
                            choose: 0,
                            miniSearch: '',
                            getData() {
                                this.miniSearch = new MiniSearch({
                                    fields: ['value'],
                                    searchOptions: {
                                        prefix: true,
                                        combineWith: 'AND',
                                    }
                                })
                                fetch('/api/danhmuc/nganh-gs-pgs')            
                                .then((response) => response.json())
                                .then((result) => {
                                    this.dataframe = result.reduce((byId, song) => {
                                        byId[song.id] = song;
                                        return byId;
                                    }, {});
                                    this.output = Object.values(this.dataframe);
                                    this.miniSearch.addAll(result);
                                });
                            },
                            filteredItems() {
                                this.showoptions = true;
                                if (thinhgiang.hocham_nganh) {
                                    this.output = this.miniSearch.search(thinhgiang.hocham_nganh).map(({ id }) => this.dataframe[id])
                                } else {
                                    this.output = Object.values(this.dataframe);
                                }
                            },
                            addItem(item) {
                                thinhgiang.hocham_nganh = item.value;
                                this.showoptions = false;
                            },
                            checkItem() {
                                this.filteredItems()
                                if (this.output.length >= 1) {
                                    if (thinhgiang.hocham_nganh != this.output[0].value) {
                                        thinhgiang.hocham_nganh = ''
                                    }
                                } else {
                                    thinhgiang.hocham_nganh = ''
                                }
                            },
                            enterEvent() {
                                if (this.output) {
                                    this.addItem(this.output[this.choose])
                                } else {
                                    thinhgiang.hocham_nganh = ''
                                }
                            },
                            eventBackspace() {
                                this.backspace = true;
                            },
                            showoptionscheck(e) {
                                if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                    this.choose = 0;
                                }
                            },
                            focusinputcheck() {
                                this.filteredItems();
                                this.showoptions = true;
                            },
                            checkchoose(index) {
                                return index === this.choose
                            },
                            selectoption(type) {
                                if (type === 'up' && this.choose > 0) {
                                    this.choose = this.choose - 1
                                    item = document.getElementById('hocham_nganh'+this.choose).getBoundingClientRect()
                                    frame = $refs.hocham_nganh.getBoundingClientRect()
                                    if ((item.bottom - frame.top) < item.height) {
                                        $refs.hocham_nganh.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                    }
                                } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                    this.choose = this.choose + 1
                                    item = document.getElementById('hocham_nganh'+this.choose).getBoundingClientRect()
                                    frame = $refs.hocham_nganh.getBoundingClientRect()
                                    if ((frame.bottom - item.top) < item.height) {
                                        $refs.hocham_nganh.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                    }
                                }
                            },
                            get checkhocham() {
                                if (thinhgiang.hocham) {
                                    return false;
                                } else {
                                    thinhgiang.hocham_nganh = ''
                                    return true;
                                }
                            }
                        }" x-init="getData()"
                        class="basis-[75%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Ngành
                            </div>
                            <input type="search"
                            :disabled="checkhocham"
                            :class="checkhocham ? 'cursor-not-allowed' : ''"
                            @focusout.debounce.100ms="checkItem();showoptions = false;"
                            @keyup.enter="enterEvent()"
                            @keydown.up.prevent.throttle.100ms="selectoption('up')"
                            @keydown.down.prevent.throttle.100ms="selectoption('down')"
                            @keyup.up.prevent
                            @keyup.down.prevent
                            x-ref="input"
                            @focus="focusinputcheck()"
                            @keyup = 'showoptionscheck'
                            @keyup.backspace="eventBackspace"
                            x-model="thinhgiang.hocham_nganh"
                            @input="filteredItems()"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">

                            <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                <ul x-ref="hocham_nganh" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[560px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                    <template x-if="output.length === 0">
                                        <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                    </template>
                                    <template x-for="(item, index) in output" :key="item.id">
                                        <li x-text="item.value"
                                        :id="'hocham_nganh'+index"
                                        @click="addItem(item)"
                                        @mouseover="choose = index"
                                        :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                        class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                    </template>
                                </ul>
                            </div>
                        </div>
                        <!-- end chuyên ngành học hàm -->
                    </div>
                    <div class="text-[16px] text-black font-[500] mt-[10px]">
                        Thông tin Công tác
                    </div>


                    <div class="w-full flex flex-row justify-start items-start gap-6">
                        <!-- {# Đơn vị mời giảng #} -->
                        <div id="donvi" class="w-full h-auto flex flex-row justify-center items-start">
                            <div x-data="{
                                showoptions: false,
                                dataframe: [],
                                output: [],
                                search: '',
                                research: '',
                                backspace: true,
                                choose: 0,
                                miniSearch: '',
                                getData() {
                                    this.miniSearch = new MiniSearch({
                                        fields: ['ten'],
                                        searchOptions: {
                                            prefix: true,
                                            combineWith: 'AND',
                                        }
                                    })
                                    fetch('/api/donvi/danhmuc')            
                                    .then((response) => response.json())
                                    .then((result) => {
                                        result = result.data
                                        this.dataframe = result.reduce((byId, song) => {
                                            byId[song.id] = song;
                                            return byId;
                                        }, {});
                                        this.output = Object.values(this.dataframe);
                                        this.miniSearch.addAll(result);
                                    });
                                },
                                filteredItems() {
                                    this.showoptions = true;
                                    if (this.search) {
                                        this.output = this.miniSearch.search(this.search).map(({ id }) => this.dataframe[id])
                                    } else {
                                        this.output = Object.values(this.dataframe);
                                    }
                                },
                                get checkresults() {
                                    return thinhgiang.donvi.length === 0
                                },
                                addItem(value) {
                                    if (! thinhgiang.donvi) {
                                        thinhgiang.donvi = [];
                                    }
                                    this.miniSearch.remove(value);
                                    delete this.dataframe[value.id]
                                    thinhgiang.donvi.push(value);
                                    this.search = '';
                                    this.filteredItems();
                                    this.showoptions = false;
                                    
                                },
                                removeItem(value) {
                                    console.log(value);
                                    thinhgiang.donvi = thinhgiang.donvi.filter(i => i !== value);
                                    this.miniSearch.add(value);
                                    this.dataframe[value.id] = value;
                                    this.filteredItems();
                                    this.showoptions = false;
                                },
                                checkItem() {
                                    this.search = ''  
                                },
                                enterEvent() {
                                    if (this.output[this.choose] && this.showoptions) {
                                        this.addItem(this.output[this.choose])
                                    } else {
                                        this.search = ''
                                        this.choose = 0;
                                        this.filteredItems();
                                    }
                                },
                                eventBackspace() {
                                    this.backspace = true;
                                },
                                checkdown() {
                                    if (this.backspace === true) {
                                        this.research = this.search;
                                        this.backspace = false;
                                        if (this.research === '' && thinhgiang.donvi.length > 0) {
                                            value = thinhgiang.donvi.at(-1);
                                            this.removeItem(value)
                                        }
                                    }
                                },
                                showoptionscheck(e) {
                                    if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                        this.choose = 0;
                                    }
                                },
                                focusinputcheck() {
                                    this.filteredItems();
                                    this.showoptions = true;
                                },
                                checkchoose(index) {
                                    return index === this.choose
                                },
                                selectoption(type) {
                                    if (type === 'up' && this.choose > 0) {
                                        this.choose = this.choose - 1
                                        item = document.getElementById('donvi'+this.choose).getBoundingClientRect()
                                        frame = $refs.donvi.getBoundingClientRect()
                                        if ((item.bottom - frame.top) < item.height) {
                                            $refs.donvi.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                        }
                                    } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                        this.choose = this.choose + 1
                                        item = document.getElementById('donvi'+this.choose).getBoundingClientRect()
                                        frame = $refs.donvi.getBoundingClientRect()
                                        if ((frame.bottom - item.top) < item.height) {
                                            $refs.donvi.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                        }
                                    }
                                }
                            }" x-init="getData()"
                            class="w-full flex flex-col justify-start items-start gap-2">
                                <div>
                                    Đơn vị mời giảng
                                </div>
                                <div x-ref="divinput"
                                @focusout.debounce.100ms="showoptions = false;"
                                @click.self="$refs.input.focus()"
                                class="cursor-text basis-[100%] w-full shrink relative rounded-lg flex flex-row justify-start items-start flex-wrap py-[12px] gap-2 bg-gray-100 p-[15px]">
                                    <template x-for="result in thinhgiang.donvi" :key="result.id">
                                        <div class="text-[15px] bg-[#ff4b4b] rounded-md text-white px-[15px] py-[3px] cursor-default flex flex-row items-center relative">
                                            <div x-text="result.ten"></div>
                                            <i @click="removeItem(result)"
                                            class="fa-solid fa-xmark cursor-pointer pl-[10px]"></i>
                                        </div>
                                    </template>
                                    <div class="rounded-lg overflow-hidden relative w-auto max-w-[100%] h-[25px] flex flex-row justify-start">
                                        <span x-text="search + 'a'" 
                                        x-ref="span" 
                                        class="invisible text-[15px] p-0"></span>
                                        <input type="text"
                                        @focusout.debounce.100ms="checkItem()"
                                        @keyup.enter="enterEvent()"
                                        @keydown.up.prevent.throttle.100ms="selectoption('up')"
                                        @keydown.down.prevent.throttle.100ms="selectoption('down')"
                                        @keyup.up.prevent
                                        @keyup.down.prevent
                                        class="bg-gray-100 p-0 w-[100%] absolute left-0 text-[15px] py-[5px] border-transparent focus:border-transparent focus:ring-0 top-[50%] translate-y-[-50%]"
                                        x-ref="input"
                                        x-model="search"
                                        @input="filteredItems()"
                                        @focus="focusinputcheck()"
                                        @keydown.backspace="checkdown()"
                                        @keyup = 'showoptionscheck'
                                        @keyup.backspace="eventBackspace"/>
                                    </div>
                                </div>

                                <div x-show="showoptions" x-anchor.bottom="$refs.divinput" class="z-[1] transition-none">
                                    <ul x-ref="donvi" class="shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[770px] h-auto max-h-[200px] flex flex-col overflow-auto">
                                        <template x-if="output.length === 0">
                                            <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                        </template>
                                        <template x-for="(item, index) in output" :key="item.id">
                                            <li x-text="item.ten"
                                            :id="'donvi'+index"
                                            @click="addItem(item)"
                                            @mouseover="choose = index"
                                            :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                            class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                        </template>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- End Đơn vị mời giảng -->
                    </div>


                    <div class="w-full flex flex-row justify-start items-start gap-6">


                        <!-- start đơn vị công tác -->
                        <div x-data="{
                            showoptions: false,
                            output: [],
                            dataframe: [],
                            research: '',
                            backspace: true,
                            choose: 0,
                            miniSearch: '',
                            async getData() {
                                this.miniSearch = new MiniSearch({
                                    fields: ['ten'],
                                    searchOptions: {
                                        prefix: true,
                                        combineWith: 'AND',
                                    }
                                })
                                console.log(type)
                                if (type == 'cohuu') {
                                    url = '/api/donvi/danhmuc'
                                } else {
                                    url = '/api/danhmuc/donvi'
                                }
                                fetch(url)            
                                .then((response) => response.json())
                                .then((result) => {
                                    result = (type == 'cohuu') ? result.data : result
                                    this.dataframe = result.reduce((byId, song) => {
                                        byId[song.id] = song;
                                        return byId;
                                    }, {});
                                    this.output = Object.values(this.dataframe);
                                    this.miniSearch.removeAll();
                                    this.miniSearch.addAll(result);
                                });
                            },
                            filteredItems() {
                                this.showoptions = true;
                                if (thinhgiang.donvicongtac) {
                                    this.output = this.miniSearch.search(thinhgiang.donvicongtac).map(({ id }) => this.dataframe[id])
                                } else {
                                    this.output = Object.values(this.dataframe);
                                }
                            },
                            addItem(item) {
                                thinhgiang.donvicongtac = item.ten;
                                this.showoptions = false;
                            },
                            checkItem() {
                                this.filteredItems()
                                if (this.output.length >= 1) {
                                    if (thinhgiang.donvicongtac != this.output[0].ten) {
                                        thinhgiang.donvicongtac = ''
                                    }
                                } else {
                                    thinhgiang.donvicongtac = ''
                                }
                            },
                            enterEvent() {
                                if (this.output) {
                                    this.addItem(this.output[this.choose])
                                } else {
                                    thinhgiang.donvicongtac = ''
                                }
                            },
                            eventBackspace() {
                                this.backspace = true;
                            },
                            showoptionscheck(e) {
                                if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                    this.choose = 0;
                                }
                            },
                            focusinputcheck() {
                                this.filteredItems();
                                this.showoptions = true;
                            },
                            checkchoose(index) {
                                return index === this.choose
                            },
                            selectoption(type) {
                                if (type === 'up' && this.choose > 0) {
                                    this.choose = this.choose - 1
                                    item = document.getElementById('donvicongtac'+this.choose).getBoundingClientRect()
                                    frame = $refs.donvicongtac.getBoundingClientRect()
                                    if ((item.bottom - frame.top) < item.height) {
                                        $refs.donvicongtac.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                    }
                                } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                    this.choose = this.choose + 1
                                    item = document.getElementById('donvicongtac'+this.choose).getBoundingClientRect()
                                    frame = $refs.donvicongtac.getBoundingClientRect()
                                    if ((frame.bottom - item.top) < item.height) {
                                        $refs.donvicongtac.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                    }
                                }
                            }
                        }" x-init="getData()"
                        class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Đơn vị công tác chính
                            </div>
                            <input type="search"
                            @focusout.debounce.100ms="checkItem();showoptions = false;"
                            @keyup.enter="enterEvent()"
                            @keydown.up.prevent.throttle.100ms="selectoption('up')"
                            @keydown.down.prevent.throttle.100ms="selectoption('down')"
                            @keyup.up.prevent
                            @keyup.down.prevent
                            x-ref="input"
                            @focus="focusinputcheck()"
                            @keyup = 'showoptionscheck'
                            @keyup.backspace="eventBackspace"
                            @portfolio.window="getData($event.detail.type)"
                            @newportfolio.window="getData($event.detail.type)"
                            x-model="thinhgiang.donvicongtac"
                            @input="filteredItems()"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">

                            <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                <ul x-ref="donvicongtac" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[385px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                    <template x-if="output.length === 0">
                                        <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                    </template>
                                    <template x-for="(item, index) in output" :key="item.id">
                                        <li x-text="item.ten"
                                        :id="'donvicongtac'+index"
                                        @click="addItem(item)"
                                        @mouseover="choose = index"
                                        :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                        class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                    </template>
                                </ul>
                            </div>
                        </div>
                        <!-- end đơn vị công tác -->

                        <!-- chức danh nghề nghiệp chính -->
                        <div x-data="{
                            showoptions: false,
                            output: [],
                            items: [{id:1,value:'Phó giáo sư'},{id:2,value:'Giáo sư'}],
                            dataframe: [],
                            research: '',
                            backspace: true,
                            choose: 0,
                            miniSearch: '',
                            getData() {
                                this.miniSearch = new MiniSearch({
                                    fields: ['value'],
                                    searchOptions: {
                                        prefix: true,
                                        combineWith: 'AND',
                                    }
                                })
                                fetch('/api/danhmuc/chucdanh')            
                                .then((response) => response.json())
                                .then((result) => {
                                    this.dataframe = result.reduce((byId, song) => {
                                        byId[song.id] = song;
                                        return byId;
                                    }, {});
                                    this.output = Object.values(this.dataframe);
                                    this.miniSearch.addAll(result);
                                });
                            },
                            filteredItems() {
                                this.showoptions = true;
                                if (thinhgiang.chucdanh) {
                                    this.output = this.miniSearch.search(thinhgiang.chucdanh).map(({ id }) => this.dataframe[id])
                                } else {
                                    this.output = Object.values(this.dataframe);
                                }
                            },
                            addItem(item) {
                                thinhgiang.chucdanh = item.value;
                                this.showoptions = false;
                            },
                            checkItem() {
                                this.filteredItems()
                                if (this.output.length >= 1) {
                                    if (thinhgiang.chucdanh != this.output[0].value) {
                                        thinhgiang.chucdanh = ''
                                    }
                                } else {
                                    thinhgiang.chucdanh = ''
                                }
                            },
                            enterEvent() {
                                if (this.output) {
                                    this.addItem(this.output[this.choose])
                                } else {
                                    thinhgiang.chucdanh = ''
                                }
                            },
                            eventBackspace() {
                                this.backspace = true;
                            },
                            showoptionscheck(e) {
                                if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                    this.choose = 0;
                                }
                            },
                            focusinputcheck() {
                                this.filteredItems();
                                this.showoptions = true;
                            },
                            checkchoose(index) {
                                return index === this.choose
                            },
                            selectoption(type) {
                                if (type === 'up' && this.choose > 0) {
                                    this.choose = this.choose - 1
                                    item = document.getElementById('chucdanh'+this.choose).getBoundingClientRect()
                                    frame = $refs.chucdanh.getBoundingClientRect()
                                    if ((item.bottom - frame.top) < item.height) {
                                        $refs.chucdanh.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                    }
                                } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                    this.choose = this.choose + 1
                                    item = document.getElementById('chucdanh'+this.choose).getBoundingClientRect()
                                    frame = $refs.chucdanh.getBoundingClientRect()
                                    if ((frame.bottom - item.top) < item.height) {
                                        $refs.chucdanh.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                    }
                                }
                            }
                        }" x-init="getData()"
                        class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Chức danh nghề nghiệp chính
                            </div>
                            <input type="search"
                            @focusout.debounce.100ms="checkItem();showoptions = false;"
                            @keyup.enter="enterEvent()"
                            @keydown.up.prevent.throttle.100ms="selectoption('up')"
                            @keydown.down.prevent.throttle.100ms="selectoption('down')"
                            @keyup.up.prevent
                            @keyup.down.prevent
                            x-ref="input"
                            @focus="focusinputcheck()"
                            @keyup = 'showoptionscheck'
                            @keyup.backspace="eventBackspace"
                            x-model="thinhgiang.chucdanh"
                            @input="filteredItems()"
                            class="w-full h-[45px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">

                            <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                <ul x-ref="chucdanh" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[385px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                    <template x-if="output.length === 0">
                                        <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                    </template>
                                    <template x-for="(item, index) in output" :key="item.id">
                                        <li x-text="item.value"
                                        :id="'chucdanh'+index"
                                        @click="addItem(item)"
                                        @mouseover="choose = index"
                                        :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                        class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                    </template>
                                </ul>
                            </div>
                        </div>
                        <!-- end chức danh nghề nghiệp chính -->

                    </div>
            

                    <div class="text-[16px] text-black font-[500] mt-[10px]">
                        Tình trạng hồ sơ
                    </div>

                    <div class="w-full flex flex-row justify-start items-start gap-6">
                        <div class="basis-[32%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Bằng cấp
                            </div>
                            <input type="checkbox" x-model="thinhgiang.co_bang">
                        </div>
                        <div class="basis-[32%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Lý lịch khoa học
                            </div>
                            <input type="checkbox" x-model="thinhgiang.co_llkh">
                        </div>
                        <div class="basis-[32%] shrink flex flex-col justify-start items-start gap-2">
                            <div>
                                Nghiệp vụ sư phạm
                            </div>
                            <input type="checkbox" x-model="thinhgiang.co_nvsp">
                        </div>
                    </div>

                    <div class="w-full border my-[15px]"></div>
                </div>

                <!-- end noi dung -->

                <!-- button -->
                <div>
                    <div class="w-full shrink flex flex-row justify-center items-start gap-2 text-[16px] mt-[10px]">
                        <input type="button" 
                        x-model="button_text"
                        @click="{id, ...thinhgiangg} = thinhgiang;
                        if (target == 'NEW') {
                            url = `/api/nhansu/${type}/create`
                        } else {
                            url = `/api/nhansu/update?id=${thinhgiang.id}`
                        }
                        fetch(url, {
                            method:'POST',
                            headers:{'Content-Type': 'application/json',},
                            body: JSON.stringify({...thinhgiangg})
                        })
                        .then((response) => response.json())
                        .then((result) => {
                            console.log(result)
                            $dispatch(`update${type}`, {data: result})
                            open = false; 
                            $dispatch('closepopup');
                        });"
                        class="bg-orange text-white py-[10px] px-[15px] rounded-md cursor-pointer font-[500]">
                    </div>
                </div>
                <!-- end button -->
            </div>
        </div>
        <!-- end hoso -->


        <!-- {# Điều chỉnh #} -->
        <div x-data="{show: false}"
        class="transition-none fixed bottom-[50%] translate-y-[60%] right-[0px] z-[2]">
            <div class="transition-none min-h-[50px] min-w-[10px] border-l-2 border-y-2 border-orange px-[5px] py-[20px] shadow-md flex flex-col justify-center items-center gap-4 relative"
            :class="show ? 'bg-white cursor-default rounded-l-2xl' : 'bg-orange cursor-pointer rounded-l-lg'"
            @mouseover="show=true" @mouseover.away="show=false">
                <div class="absolute left-[1px]">
                    <i x-show="!show" class="text-white fa-solid fa-caret-left"></i>
                </div>
                <div x-show="show" x-data="{type: 'cohuu'}"
                @tab1.window="type='cohuu'"
                @tab2.window="type='thinhgiang'"
                @click="$dispatch('newportfolio', {type: type})"
                class="w-[30px] h-[30px] bg-orange text-white text-[16px] font-[500] rounded-full flex justify-center items-center gap-2 cursor-pointer">
                    <i class="fa-solid fa-plus"></i>
                </div>
                <div x-show="show"
                @click="$dispatch('modify')"
                class="w-[30px] h-[30px] bg-orange text-white text-[16px] font-[500] rounded-full flex justify-center items-center gap-2 cursor-pointer">
                    <i class="fa-solid fa-table"></i>
                </div>
            </div>
        </div>
        <!-- {# End Điều chỉnh #} -->


        <!-- {# download/upload #} -->
        <div x-data="{open: false}" @modify.window="open = ! open" class="fixed left-0 top-0 z-[2000]">
            <div x-show="open" 
            @click="open = ! open; $dispatch('closepopup'); htmx.trigger('#upload-form', 'htmx:abort')" 
            @keyup.escape.window="open = ! open; $dispatch('closepopup'); htmx.trigger('#upload-form', 'htmx:abort')" 
            class="w-screen h-screen bg-black opacity-70"></div>
            <div x-show="open" class="rounded-xl overflow-hidden fixed top-[50%] translate-y-[-50%] left-[50%] translate-x-[-50%] w-[500px] h-[400px] bg-white opacity-100">
                <div id="form" 
                hx-trigger="modify from:body"
                hx-get="/template/nhansu/form/upload"
                hx-ext="alpine-morph"
                hx-swap="multi:#form:morph"
                class="w-full h-full flex justify-center items-center">
                    <div class="htmx-indicator flex flex-col gap-6 w-[400px]">
                        <div class="skeleton h-32 w-full"></div>
                        <div class="skeleton h-4 w-28"></div>
                        <div class="skeleton h-4 w-full"></div>
                        <div class="skeleton h-4 w-full"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- {# End download/upload #} -->


        <!-- start lấy số hợp đồng -->
        <div x-data="{
            sohopdong:'',
            hopdong: {},
            success: false,
            open: false, 
            giangvien: {}, 
            nguoilayso: {},
            currentR: 1,
            checkR(value) {
                return this.currentR >= value
            },
            checkBR(value) {
                return this.currentR <= value
            },
            checkER(value) {
                return this.currentR == value
            }
        }"
        x-show="open" 
        @runlayso.window="
        currentR = 1
        success = false
        giangvien = $event.detail.giangvien
        fetch(`/api/nhansu/me/search`)
        .then((response) => response.json())
        .then((result) => {
            nguoilayso = result;
            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            if ([1,2].includes(today.getMonth() + 1)) {
                mm = (today.getMonth()+1).toString().padStart(2,'0')
            } else {
                mm = (today.getMonth()+1).toString()
            }
            var yyyy = today.getFullYear();
            hopdong.ngayky = dd + '/' + mm + '/' + yyyy
            hopdong.nguoidaidien = 'TS. Phạm Tấn Hạ'
            hopdong.giangvien = giangvien.maso
            hopdong.donvimoi = nguoilayso.donvicongtac
            hopdong.nguoiphutrach = nguoilayso.maso
            hopdong.he = 'Chính quy (Chuẩn)'
            hopdong.namhoc = '2023-2024'
            hopdong.hocky = 'HK1'
            open = true
        });"
        class="flex justify-center items-start fixed left-0 top-0 h-screen w-screen z-[3001] py-[20px] overflow-auto">
            <div x-show="open"
                @keyup.escape.window="open = false; $dispatch('closepopup');" 
                class="fixed left-0 top-0 w-screen h-screen bg-black opacity-70">
            </div>


            <!-- start form lấy số -->
            <div class="bg-white opacity-100 overflow-hidden z-[1] transition-none rounded-lg w-[800px] h-auto flex flex-col justify-start items-center mx-[16px] mt-[25px] mb-[25px] border px-[16px] pt-[32px] pb-[16px]">
    
                {# tieu de form #}
                <div class="w-full flex flex-col gap-4 justify-start items-center mb-[20px]">
                    <div class="w-full text-[27px] font-[600] leading-tight mb-[20px]">
                        Lấy số hợp đồng mời giảng
                    </div>
                    <div class="flex flex-row justify-center items-start">
                        <div class="flex flex-col justify-center items-center w-[100px] cursor-default">
                            <div :class="checkBR(4) ? 'border-none text-white bg-orange' : 'border-2 text-gray-400'"
                            class="w-[25px] h-[25px] rounded-full  font-[500] flex flex-col justify-center items-center"><span>1</span></div>
                            <div class="font-[500] text-gray-500">Nhập thông tin</div>
                        </div>
                        <span><i class="fa-solid fa-chevron-right text-gray-400"></i></span>
                        <div class="flex flex-col justify-center items-center w-[100px] cursor-default">
                            <div :class="checkER(5) ? 'border-none text-white bg-orange' : 'border-2 text-gray-400'"
                            class="w-[25px] h-[25px] rounded-full  font-[500] flex flex-col justify-center items-center"><span>2</span></div>
                            <div class="font-[500] text-gray-500">Xác nhận</div>
                        </div>
                        <span><i class="fa-solid fa-chevron-right text-gray-400"></i></span>
                        <div class="flex flex-col justify-center items-center w-[100px] cursor-default">
                            <div :class="checkER(6) ? 'border-none text-white bg-orange' : 'border-2 text-gray-400'"
                            class="w-[25px] h-[25px] rounded-full  font-[500] flex flex-col justify-center items-center"><span>3</span></div>
                            <div class="font-[500] text-gray-500">Hoàn Thành</div>
                        </div>
                    </div>
                    <div class="w-full border m-[15px]"></div>
                    <div x-show="!checkR(5)" class="flex flex-row justify-center items-start">
                        <div class="flex flex-row justify-center items-center gap-3">
                            <div :class="checkR(1) ? 'text-white bg-orange border-none' : 'border-2'" class="w-[12px] h-[12px] rounded-full font-[500]"></div>
                            <div :class="checkR(2) ? 'text-white bg-orange border-none' : 'border-2'" class="w-[12px] h-[12px] rounded-full font-[500]"></div>
                            <div :class="checkR(3) ? 'text-white bg-orange border-none' : 'border-2'" class="w-[12px] h-[12px] rounded-full font-[500]"></div>
                            <div :class="checkR(4) ? 'text-white bg-orange border-none' : 'border-2'" class="w-[12px] h-[12px] rounded-full font-[500]"></div>
                        </div>
                    </div>
                </div>
                {# end tieu de form #}
    
                <!-- {# body form #} -->
                <div class="w-full flex flex-col justify-start items-start gap-6 mb-[10px] z-[2]">
                    <!-- {# thông tin hợp đồng #} -->
                    <div x-show="checkER(1)||checkER(5)" class="w-full flex flex-col justify-start items-start gap-6 mb-[10px]">
                        <div class="text-[16px] text-black font-[500]">
                            Thông tin hợp đồng
                        </div>
    
                        <div class="w-full flex flex-row justify-start items-start gap-6">
                            <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                                <div>
                                    Người đại diện Trường
                                </div>
                                <input type="search"
                                disabled
                                x-model="hopdong.nguoidaidien"
                                class="cursor-not-allowed text-gray-400 w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                            </div>
    
                            <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                                <div>
                                    Ngày ký hợp đồng
                                </div>
                                <input x-data="{
                                    checkStrDate(str) {
                                        if (str) {
                                            const result = [...str].every(
                                                char => (char >= '0' && char <= '9') || (char == '/')
                                            );
                                            return result;
                                        } else {
                                            return false
                                        }
                                    },
                                    converDay() {
                                        if (this.checkStrDate(hopdong.ngayky)) {
                                            list = hopdong.ngayky.split('/');
                                            d = Number(list[0])
                                            m = Number(list[1])
                                            y = Number(list[2])
                                            if (list.length !== 3 || 
                                                list[0].length > 2 || 
                                                list[1].length > 2 || 
                                                list[2].length > 4 || 
                                                list[2].length == 3 ||
                                                d > 31 ||
                                                m > 12 ||
                                                y > 2099) {
                                                hopdong.ngayky = ''
                                            } else {
                                                today = new Date();
                                                currentYear = today.getFullYear();
    
                                                if (list[2].length == 2) {
                                                    if (y > (currentYear - 2000)) {
                                                        year_num = y + 1900
                                                    } else {
                                                        year_num = y + 2000
                                                    }
                                                } else {
                                                    year_num = y
                                                }
                                                if ((m == 2 && d > 29) || ([1,3,5,7,8,10,12].includes(m) && d > 31) || ([2,4,6,9,11].includes(m) && d > 30)) {
                                                    hopdong.ngayky = ''
                                                } else {
                                                    day = d.toString().padStart(2,'0')
                                                    if ([1,2].includes(m)) {
                                                        month = m.toString().padStart(2,'0')
                                                    } else {
                                                        month = m.toString()
                                                    }
                                                    year = year_num.toString()
                                                    hopdong.ngayky = `${day}/${month}/${year}`
                                                }
                                            }
                                        } else {
                                            hopdong.ngayky = ''
                                        }
     
                                    }
                                }"
                                type="search"
                                @focusout="converDay()"
                                @keyup.enter="converDay()"
                                x-model="hopdong.ngayky"
                                :disabled="checkER(5)"
                                :class="checkER(5) ? 'cursor-not-allowed text-gray-400' : 'text-gray-600'"
                                class="w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                            </div>
                        </div>
    
                    </div>
                    <!-- {# end thông tin hợp đồng #} -->

                    <!-- {# thông tin giảng viên #} -->
                    <div x-show="checkER(2)||checkER(5)" class="w-full flex flex-col justify-start items-start gap-6 mb-[10px]">
                        <div class="text-[16px] text-black font-[500]">
                            Thông tin giảng viên mời giảng
                        </div>
    
                        <div class="w-full flex flex-row justify-start items-start gap-6">
                            <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                                <div>
                                    Họ và tên
                                </div>
                                <input type="search"
                                disabled 
                                x-model="giangvien.hovaten"
                                class="cursor-not-allowed text-gray-400 w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                            </div>
    
                            <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                                <div>
                                    Mã số
                                </div>
                                <input type="search"
                                disabled
                                x-model="hopdong.giangvien"
                                class="text-gray-400 cursor-not-allowed w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                            </div>
                        </div>
    
                    </div>
                    <!-- {# end thông tin giảng viên #} -->
    
                    <!-- {# thông tin đơn vị mời giảng #} -->
                    <div x-show="checkER(3)||checkER(5)" class="w-full flex flex-col justify-start items-start gap-6 mb-[10px]">
                        <div class="text-[16px] text-black font-[500]">
                            Thông tin đơn vị mời giảng
                        </div>

                        <!-- start đơn vị mời giảng -->
                        <div class="w-full flex flex-row justify-start items-start gap-6">
                            <div x-data="{
                                showoptions: false,
                                output: [],
                                dataframe: [],
                                research: '',
                                backspace: true,
                                choose: 0,
                                miniSearch: '',
                                async getData() {
                                    this.miniSearch = new MiniSearch({
                                        fields: ['ten'],
                                        searchOptions: {
                                            prefix: true,
                                            combineWith: 'AND',
                                        }
                                    })
                                    url = '/api/donvi/danhmuc'
                                    fetch(url)            
                                    .then((response) => response.json())
                                    .then((result) => {
                                        result = result.data
                                        this.dataframe = result.reduce((byId, song) => {
                                            byId[song.id] = song;
                                            return byId;
                                        }, {});
                                        this.output = Object.values(this.dataframe);
                                        this.miniSearch.removeAll();
                                        this.miniSearch.addAll(result);
                                        console.log('loading done')
                                    });
                                },
                                filteredItems() {
                                    this.showoptions = true;
                                    if (hopdong.donvimoi) {
                                        this.output = this.miniSearch.search(hopdong.donvimoi).map(({ id }) => this.dataframe[id])
                                    } else {
                                        this.output = Object.values(this.dataframe);
                                    }
                                },
                                addItem(item) {
                                    hopdong.donvimoi = item.ten;
                                    this.showoptions = false;
                                },
                                checkItem() {
                                    this.filteredItems()
                                    if (this.output.length >= 1) {
                                        if (hopdong.donvimoi != this.output[0].ten) {
                                            hopdong.donvimoi = ''
                                        }
                                    } else {
                                        hopdong.donvimoi = ''
                                    }
                                },
                                enterEvent() {
                                    if (this.output) {
                                        this.addItem(this.output[this.choose])
                                    } else {
                                        hopdong.donvimoi = ''
                                    }
                                },
                                eventBackspace() {
                                    this.backspace = true;
                                },
                                showoptionscheck(e) {
                                    if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                        this.choose = 0;
                                    }
                                },
                                focusinputcheck() {
                                    this.filteredItems();
                                    this.showoptions = true;
                                },
                                checkchoose(index) {
                                    return index === this.choose
                                },
                                selectoption(type) {
                                    if (type === 'up' && this.choose > 0) {
                                        this.choose = this.choose - 1
                                        item = document.getElementById('donvicongtac'+this.choose).getBoundingClientRect()
                                        frame = $refs.donvicongtac.getBoundingClientRect()
                                        if ((item.bottom - frame.top) < item.height) {
                                            $refs.donvicongtac.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                        }
                                    } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                        this.choose = this.choose + 1
                                        item = document.getElementById('donvicongtac'+this.choose).getBoundingClientRect()
                                        frame = $refs.donvicongtac.getBoundingClientRect()
                                        if ((frame.bottom - item.top) < item.height) {
                                            $refs.donvicongtac.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                        }
                                    }
                                }
                            }" x-init="getData()"
                            class="w-full shrink flex flex-col justify-start items-start gap-2">
                                <div>
                                    Tên đơn vị mời giảng
                                </div>
                                <input type="search" 
                                @focusout.debounce.100ms="checkItem();showoptions = false;"
                                @keyup.enter="enterEvent()"
                                @keydown.up.prevent.throttle.100ms="selectoption('up')"
                                @keydown.down.prevent.throttle.100ms="selectoption('down')"
                                @keyup.up.prevent
                                @keyup.down.prevent
                                @focus="focusinputcheck()"
                                @keyup = 'showoptionscheck'
                                @keyup.backspace="eventBackspace"
                                @input="filteredItems()"
                                x-ref="input"
                                x-model="hopdong.donvimoi"
                                :disabled="checkER(5)"
                                :class="checkER(5) ? 'cursor-not-allowed text-gray-400' : 'text-gray-600'"
                                class="w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                                <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                    <ul x-ref="donvicongtac" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[768px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                        <template x-if="output.length === 0">
                                            <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                        </template>
                                        <template x-for="(item, index) in output" :key="item.id">
                                            <li x-text="item.ten"
                                            :id="'donvicongtac'+index"
                                            @click="addItem(item)"
                                            @mouseover="choose = index"
                                            :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                            class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                        </template>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- end đơn vị mời giảng -->

                        <div class="w-full flex flex-row justify-start items-start gap-6">
                            <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                                <div>
                                    Họ và tên người phụ trách
                                </div>
                                <input type="search" 
                                disabled 
                                x-model="nguoilayso.hovaten"
                                disabled
                                class="cursor-not-allowed text-gray-400 w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                            </div>
    
                            <div class="basis-[50%] shrink flex flex-col justify-start items-start gap-2">
                                <div>
                                    Mã số người phụ trách
                                </div>
                                <input type="search"
                                x-model="hopdong.nguoiphutrach"
                                disabled
                                class="text-gray-400 cursor-not-allowed w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                            </div>
                        </div>
    
                    </div>
                    <!-- {# end thông tin đơn vị mời giảng #} -->


                    <!-- {# thông tin giảng dạy #} -->
                    <div x-show="checkER(4)||checkER(5)" class="w-full flex flex-col justify-start items-start gap-6 mb-[10px]">
                        <div class="text-[16px] text-black font-[500]">
                            Thông tin giảng dạy
                        </div>
                        <div class="w-full flex flex-row justify-start items-start gap-6">

                            <!-- start hệ đào tạo -->
                            <div x-data="{
                                showoptions: false,
                                output: [],
                                dataframe: [],
                                research: '',
                                backspace: true,
                                choose: 0,
                                miniSearch: '',
                                async getData() {
                                    this.miniSearch = new MiniSearch({
                                        fields: ['value'],
                                        searchOptions: {
                                            prefix: true,
                                            combineWith: 'AND',
                                        }
                                    })
                                    url = '/api/danhmuc/hedaotao'
                                    fetch(url)            
                                    .then((response) => response.json())
                                    .then((result) => {
                                        result = result
                                        this.dataframe = result.reduce((byId, song) => {
                                            byId[song.id] = song;
                                            return byId;
                                        }, {});
                                        this.output = Object.values(this.dataframe);
                                        this.miniSearch.removeAll();
                                        this.miniSearch.addAll(result);
                                    });
                                },
                                filteredItems() {
                                    console.log('searching...')
                                    this.showoptions = true;
                                    if (hopdong.he) {
                                        this.output = this.miniSearch.search(hopdong.he).map(({ id }) => this.dataframe[id])
                                        console.log(this.output)
                                    } else {
                                        this.output = Object.values(this.dataframe);
                                    }
                                },
                                addItem(item) {
                                    hopdong.he = item.value;
                                    this.showoptions = false;
                                },
                                checkItem() {
                                    this.filteredItems()
                                    if (this.output.length >= 1) {
                                        if (hopdong.he != this.output[0].value) {
                                            hopdong.he = ''
                                        }
                                    } else {
                                        hopdong.he = ''
                                    }
                                },
                                enterEvent() {
                                    if (this.output) {
                                        this.addItem(this.output[this.choose])
                                    } else {
                                        hopdong.he = ''
                                    }
                                },
                                eventBackspace() {
                                    this.backspace = true;
                                },
                                showoptionscheck(e) {
                                    if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                        this.choose = 0;
                                    }
                                },
                                focusinputcheck() {
                                    this.filteredItems();
                                    this.showoptions = true;
                                },
                                checkchoose(index) {
                                    return index === this.choose
                                },
                                selectoption(type) {
                                    if (type === 'up' && this.choose > 0) {
                                        this.choose = this.choose - 1
                                        item = document.getElementById('donvicongtac'+this.choose).getBoundingClientRect()
                                        frame = $refs.donvicongtac.getBoundingClientRect()
                                        if ((item.bottom - frame.top) < item.height) {
                                            $refs.donvicongtac.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                        }
                                    } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                        this.choose = this.choose + 1
                                        item = document.getElementById('donvicongtac'+this.choose).getBoundingClientRect()
                                        frame = $refs.donvicongtac.getBoundingClientRect()
                                        if ((frame.bottom - item.top) < item.height) {
                                            $refs.donvicongtac.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                        }
                                    }
                                }
                            }" x-init="getData()"
                            class="basis-[33%] shrink flex flex-col justify-start items-start gap-2">
                                <div>
                                    Hệ đào tạo
                                </div>
                                <input type="search" 
                                @focusout.debounce.100ms="checkItem();showoptions = false;"
                                @keyup.enter="enterEvent()"
                                @keydown.up.prevent.throttle.100ms="selectoption('up')"
                                @keydown.down.prevent.throttle.100ms="selectoption('down')"
                                @keyup.up.prevent
                                @keyup.down.prevent
                                @focus="focusinputcheck()"
                                @keyup = 'showoptionscheck'
                                @keyup.backspace="eventBackspace"
                                @input="filteredItems()"
                                x-ref="input"
                                x-model="hopdong.he"
                                :disabled="checkER(5)"
                                :class="checkER(5) ? 'cursor-not-allowed text-gray-400' : 'text-gray-600'"
                                class="w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                                <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                    <ul x-ref="donvicongtac" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[240px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                        <template x-if="output.length === 0">
                                            <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                        </template>
                                        <template x-for="(item, index) in output" :key="item.id">
                                            <li x-text="item.value"
                                            :id="'donvicongtac'+index"
                                            @click="addItem(item)"
                                            @mouseover="choose = index"
                                            :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                            class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                        </template>
                                    </ul>
                                </div>
                            </div>
                            <!-- end Hệ đào tạo -->

                            <!-- start Nam hoc -->
                            <div x-data="{
                                showoptions: false,
                                output: [],
                                dataframe: [],
                                research: '',
                                backspace: true,
                                choose: 0,
                                miniSearch: '',
                                async getData() {
                                    this.miniSearch = new MiniSearch({
                                        fields: ['value'],
                                        searchOptions: {
                                            prefix: true,
                                            combineWith: 'AND',
                                        }
                                    })
                                    url = '/api/danhmuc/namhoc'
                                    fetch(url)            
                                    .then((response) => response.json())
                                    .then((result) => {
                                        result = result
                                        this.dataframe = result.reduce((byId, song) => {
                                            byId[song.id] = song;
                                            return byId;
                                        }, {});
                                        this.output = Object.values(this.dataframe);
                                        this.miniSearch.removeAll();
                                        this.miniSearch.addAll(result);
                                    });
                                },
                                filteredItems() {
                                    console.log('searching...')
                                    this.showoptions = true;
                                    if (hopdong.namhoc) {
                                        this.output = this.miniSearch.search(hopdong.namhoc).map(({ id }) => this.dataframe[id])
                                        console.log(this.output)
                                    } else {
                                        this.output = Object.values(this.dataframe);
                                    }
                                },
                                addItem(item) {
                                    hopdong.namhoc = item.value;
                                    this.showoptions = false;
                                },
                                checkItem() {
                                    this.filteredItems()
                                    if (this.output.length >= 1) {
                                        if (hopdong.namhoc != this.output[0].value) {
                                            hopdong.namhoc = ''
                                        }
                                    } else {
                                        hopdong.namhoc = ''
                                    }
                                },
                                enterEvent() {
                                    if (this.output) {
                                        this.addItem(this.output[this.choose])
                                    } else {
                                        hopdong.namhoc = ''
                                    }
                                },
                                eventBackspace() {
                                    this.backspace = true;
                                },
                                showoptionscheck(e) {
                                    if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                        this.choose = 0;
                                    }
                                },
                                focusinputcheck() {
                                    this.filteredItems();
                                    this.showoptions = true;
                                },
                                checkchoose(index) {
                                    return index === this.choose
                                },
                                selectoption(type) {
                                    if (type === 'up' && this.choose > 0) {
                                        this.choose = this.choose - 1
                                        item = document.getElementById('donvicongtac'+this.choose).getBoundingClientRect()
                                        frame = $refs.donvicongtac.getBoundingClientRect()
                                        if ((item.bottom - frame.top) < item.height) {
                                            $refs.donvicongtac.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                        }
                                    } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                        this.choose = this.choose + 1
                                        item = document.getElementById('donvicongtac'+this.choose).getBoundingClientRect()
                                        frame = $refs.donvicongtac.getBoundingClientRect()
                                        if ((frame.bottom - item.top) < item.height) {
                                            $refs.donvicongtac.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                        }
                                    }
                                }
                            }" x-init="getData()"
                            class="basis-[33%] shrink flex flex-col justify-start items-start gap-2">
                                <div>
                                    Năm học
                                </div>
                                <input type="search" 
                                @focusout.debounce.100ms="checkItem();showoptions = false;"
                                @keyup.enter="enterEvent()"
                                @keydown.up.prevent.throttle.100ms="selectoption('up')"
                                @keydown.down.prevent.throttle.100ms="selectoption('down')"
                                @keyup.up.prevent
                                @keyup.down.prevent
                                @focus="focusinputcheck()"
                                @keyup = 'showoptionscheck'
                                @keyup.backspace="eventBackspace"
                                @input="filteredItems()"
                                x-ref="input"
                                x-model="hopdong.namhoc"
                                :disabled="checkER(5)"
                                :class="checkER(5) ? 'cursor-not-allowed text-gray-400' : 'text-gray-600'"
                                class="w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                                <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                    <ul x-ref="donvicongtac" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[240px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                        <template x-if="output.length === 0">
                                            <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                        </template>
                                        <template x-for="(item, index) in output" :key="item.id">
                                            <li x-text="item.value"
                                            :id="'donvicongtac'+index"
                                            @click="addItem(item)"
                                            @mouseover="choose = index"
                                            :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                            class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                        </template>
                                    </ul>
                                </div>
                            </div>
                            <!-- end Nam hoc -->
    
                            <!-- start học kỳ -->
                            <div x-data="{
                                showoptions: false,
                                output: [],
                                dataframe: [],
                                research: '',
                                backspace: true,
                                choose: 0,
                                miniSearch: '',
                                async getData() {
                                    this.miniSearch = new MiniSearch({
                                        fields: ['value'],
                                        searchOptions: {
                                            prefix: true,
                                            combineWith: 'AND',
                                        }
                                    })
                                    url = '/api/danhmuc/hocky'
                                    fetch(url)            
                                    .then((response) => response.json())
                                    .then((result) => {
                                        result = result
                                        this.dataframe = result.reduce((byId, song) => {
                                            byId[song.id] = song;
                                            return byId;
                                        }, {});
                                        this.output = Object.values(this.dataframe);
                                        this.miniSearch.removeAll();
                                        this.miniSearch.addAll(result);
                                    });
                                },
                                filteredItems() {
                                    console.log('searching...')
                                    this.showoptions = true;
                                    if (hopdong.hocky) {
                                        this.output = this.miniSearch.search(hopdong.hocky).map(({ id }) => this.dataframe[id])
                                        console.log(this.output)
                                    } else {
                                        this.output = Object.values(this.dataframe);
                                    }
                                },
                                addItem(item) {
                                    hopdong.hocky = item.value;
                                    this.showoptions = false;
                                },
                                checkItem() {
                                    this.filteredItems()
                                    if (this.output.length >= 1) {
                                        if (hopdong.hocky != this.output[0].value) {
                                            hopdong.hocky = ''
                                        }
                                    } else {
                                        hopdong.hocky = ''
                                    }
                                },
                                enterEvent() {
                                    if (this.output) {
                                        this.addItem(this.output[this.choose])
                                    } else {
                                        hopdong.hocky = ''
                                    }
                                },
                                eventBackspace() {
                                    this.backspace = true;
                                },
                                showoptionscheck(e) {
                                    if (e.keyCode == 32 || e.keyCode == 189 || (e.keyCode >= 48 && e.keyCode <= 90) || (e.keyCode >= 96 && e.keyCode <= 105)) {
                                        this.choose = 0;
                                    }
                                },
                                focusinputcheck() {
                                    this.filteredItems();
                                    this.showoptions = true;
                                },
                                checkchoose(index) {
                                    return index === this.choose
                                },
                                selectoption(type) {
                                    if (type === 'up' && this.choose > 0) {
                                        this.choose = this.choose - 1
                                        item = document.getElementById('donvicongtac'+this.choose).getBoundingClientRect()
                                        frame = $refs.donvicongtac.getBoundingClientRect()
                                        if ((item.bottom - frame.top) < item.height) {
                                            $refs.donvicongtac.scrollBy(0,-(item.height - (item.bottom - frame.top)))
                                        }
                                    } else if (type === 'down' && this.choose < (this.output.length - 1)) {
                                        this.choose = this.choose + 1
                                        item = document.getElementById('donvicongtac'+this.choose).getBoundingClientRect()
                                        frame = $refs.donvicongtac.getBoundingClientRect()
                                        if ((frame.bottom - item.top) < item.height) {
                                            $refs.donvicongtac.scrollBy(0,(item.height + (item.top - frame.bottom)))
                                        }
                                    }
                                }
                            }" x-init="getData()"
                            class="basis-[33%] shrink flex flex-col justify-start items-start gap-2">
                                <div>
                                    Năm học
                                </div>
                                <input type="search" 
                                @focusout.debounce.100ms="checkItem();showoptions = false;"
                                @keyup.enter="enterEvent()"
                                @keydown.up.prevent.throttle.100ms="selectoption('up')"
                                @keydown.down.prevent.throttle.100ms="selectoption('down')"
                                @keyup.up.prevent
                                @keyup.down.prevent
                                @focus="focusinputcheck()"
                                @keyup = 'showoptionscheck'
                                @keyup.backspace="eventBackspace"
                                @input="filteredItems()"
                                x-ref="input"
                                x-model="hopdong.hocky"
                                :disabled="checkER(5)"
                                :class="checkER(5) ? 'cursor-not-allowed text-gray-400' : 'text-gray-600'"
                                class="w-full h-[40px] rounded-lg bg-gray-100 border-transparent focus:border-orange focus:ring-0">
                                <div x-show="showoptions" x-anchor.bottom="$refs.input" class="transition-none">
                                    <ul x-ref="donvicongtac" class="border-2 shadow-[0px_4px_16px_rgba(17,17,26,0.1),_0px_8px_24px_rgba(17,17,26,0.1),_0px_16px_56px_rgba(17,17,26,0.1)] bg-white rounded-lg w-[240px] h-auto max-h-[200px] overflow-auto flex flex-col z-[1]">
                                        <template x-if="output.length === 0">
                                            <li class="w-full text-gray-400 cursor-default py-[10px] px-[20px]">Không tìm thấy kết quả nào</li>
                                        </template>
                                        <template x-for="(item, index) in output" :key="item.id">
                                            <li x-text="item.value"
                                            :id="'donvicongtac'+index"
                                            @click="addItem(item)"
                                            @mouseover="choose = index"
                                            :class="checkchoose(index) ? 'bg-gray-100' : ''"
                                            class="transition-none text-left w-full cursor-pointer py-[10px] px-[20px]"></li>
                                        </template>
                                    </ul>
                                </div>
                            </div>
                            <!-- end học kỳ -->
                        </div>
    
                    </div>
                    <!-- {# end thông tin giảng dạy #} -->                   


                    <!-- {# start trang hoàn thành #} -->
                    <div x-show="checkER(6)" class="w-full flex flex-col justify-center items-center gap-6 mb-[10px]">
                        <div class="flex flex-col justify-center items-center text-[30px]  font-[500] gap-10">
                            <i x-show="!success" class="fa-solid fa-spinner fa-spin-pulse text-yellow-500 text-[60px]"></i>
                            <i x-show="success" class="fa-regular fa-circle-check text-green text-[60px]"></i>
                            <div x-show="success" x-text="'Đã tạo hợp đồng: '+sohopdong" class="text-black"></div>
                            <div x-show="success" class="text-black hover:text-sky-600 text-[16px] underline font-[400] cursor-pointer">Tới trang quản lý hợp đồng</div>
                            <div x-show="success" class="text-black hover:text-sky-600 text-[16px] underline font-[400] cursor-pointer"
                            @click="open = false; $dispatch('closepopup');">Tiếp tục lấy số</div>
                        </div>
                    </div>
                    <!-- {# end trang hoàn thành #} --> 

                    <div class="w-full border my-[15px]"></div>
                </div>
    
                <div class="w-full flex flex-row justify-between items-start mb-[20px] z-[1]">
                    <div class="">
                        <!-- {# button cancel #} -->
                        <input type="submit"
                        :value="checkER(6) ? 'Close' : 'Cancel'"
                        @click="open = false; $dispatch('closepopup');"
                        class="hover:border-orange hover:text-orange z-[1] text-[14px] font-[500] px-[20px] py-[5px] rounded-lg leading-normal cursor-pointer border border-gray-500 text-gray-600">
                        <!-- {# end button cancel #} -->
                    </div>
    
                    <div class="flex flex-row justify-end items-start gap-4">
                        <!-- {# button back #} -->
                        <input type="submit"
                        x-show="!checkR(6)"
                        value="Back"
                        @click="currentR-=1"
                        :disabled="checkBR(1)"
                        :class="checkBR(1) ? 'cursor-not-allowed text-gray-400 border-gray-400' : 'hover:border-orange hover:text-orange cursor-pointer text-gray-600 border-gray-500'"
                        class="z-[1] text-[14px] font-[500] px-[20px] py-[5px] rounded-lg leading-normal border">
                        <!-- {# end button back #} -->
                        <!-- {# button Next #} -->
                        <input type="submit"
                        x-show="!checkR(6)"
                        :value="checkER(5) ? 'Finish' : 'Next'"
                        @click="
                            currentR+=1
                            if (checkER(6)) {
                                console.log(hopdong)
                                url = '/api/hopdong/create'
                                fetch(url, {
                                    method:'POST',
                                    headers:{'Content-Type': 'application/json',},
                                    body: JSON.stringify({...hopdong})
                                })
                                .then((response) => response.json())
                                .then((result) => {
                                    console.log(result)
                                    sohopdong = result.hopdong
                                    success = result.message == 'success' ? true : false
                                })
                            }
                        "
                        :class="checkER(5) ? 'bg-orange text-white border-orange' : 'hover:border-orange hover:text-orange text-gray-600  border-gray-500'"
                        class="z-[1] text-[14px] font-[500] px-[20px] py-[5px] rounded-lg leading-normal border cursor-pointer">
                        <!-- {# end button Next #} -->
                    </div>
                </div>
    
            </div>
            <!-- end form lấy số -->

        </div>
        <!-- end lấy số hợp đồng -->

    </div>  
</div>